<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EchoStory‚Ñ¢ | EchoVerse by AeroVista</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Create a custom musical tribute - Your story, turned into song. Interactive wizard to build your perfect EchoStory‚Ñ¢ experience.">
<style>
    /* ============================================
       PREMIUM ANIMATION SYSTEM & TIMING VARIABLES
       ============================================ */
    :root {
        /* Vibrant Synthwave Color System */
        --bg: #0a0118;
        --bg-soft: #1a0b2e;
        --bg-softer: #2d1b4e;
        --bg-card: #3d2563;
        
        --accent: #ff006e;
        --accent-soft: #ff4d94;
        --accent-orange: #fb8500;
        --accent-cyan: #00d9ff;
        --accent-purple: #b537f2;
        --accent-blue: #4361ee;
        
        --text: #ffffff;
        --text-soft: #e0d9ff;
        --muted: #9d8ec7;
        --danger: #ff006e;
        --success: #00d9ff;
        
        /* Animation Timing (Premium Quality) */
        --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-bounce: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        
        /* Vibrant Gradients */
        --gradient-primary: linear-gradient(135deg, #ff006e 0%, #fb8500 100%);
        --gradient-secondary: linear-gradient(135deg, #4361ee 0%, #b537f2 100%);
        --gradient-accent: linear-gradient(135deg, #00d9ff 0%, #b537f2 100%);
        --gradient-text: linear-gradient(135deg, #00d9ff 0%, #ff006e 50%, #fb8500 100%);
        
        /* Neon Glows */
        --glow-pink: 0 0 20px rgba(255, 0, 110, 0.5), 0 0 40px rgba(255, 0, 110, 0.3);
        --glow-orange: 0 0 20px rgba(255, 107, 53, 0.5), 0 0 40px rgba(255, 107, 53, 0.3);
        --glow-cyan: 0 0 20px rgba(0, 217, 255, 0.5), 0 0 40px rgba(0, 217, 255, 0.3);
        --glow-purple: 0 0 20px rgba(181, 55, 242, 0.5), 0 0 40px rgba(181, 55, 242, 0.3);
        
        /* Theme Variables (Dynamic - for occasion theming) */
        --theme-primary: #ff006e;
        --theme-secondary: #4361ee;
        --theme-accent: #fb8500;
        --theme-glow: rgba(255, 0, 110, 0.3);
    }
    
    * { 
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    html {
        scroll-behavior: smooth;
    }
    
    body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    /* ============================================
       MULTI-LAYER ANIMATED BACKGROUND SYSTEM
       ============================================ */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 20%, rgba(255, 0, 110, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(67, 97, 238, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(251, 133, 0, 0.1) 0%, transparent 70%),
            linear-gradient(135deg, #0a0118 0%, #1a0b2e 30%, #2d1b4e 70%, #1a0b2e 100%);
        background-size: 200% 200%;
        animation: gradientShift 15s ease infinite;
        z-index: -2;
        will-change: background-position;
        pointer-events: none;
    }
    
    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 60% 20%, rgba(181, 55, 242, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 30% 80%, rgba(0, 217, 255, 0.08) 0%, transparent 50%);
        background-size: 300% 300%, 250% 250%;
        animation: gradientShiftReverse 25s ease infinite;
        z-index: -1;
        opacity: 0.7;
        will-change: background-position;
        pointer-events: none;
    }
    
    @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%, 50% 0%, 0% 100%, 0% 0%; }
        33% { background-position: 100% 100%, 0% 50%, 50% 0%, 50% 50%; }
        66% { background-position: 50% 0%, 100% 100%, 100% 50%, 100% 100%; }
    }
    
    @keyframes gradientShiftReverse {
        0%, 100% { background-position: 100% 0%, 0% 100%; }
        50% { background-position: 0% 100%, 100% 0%; }
    }
    
    /* Floating Particles */
    .particle {
        position: fixed;
        width: 3px;
        height: 3px;
        background: var(--accent-cyan);
        border-radius: 50%;
        opacity: 0.6;
        animation: float 25s infinite linear;
        z-index: -1;
        will-change: transform, opacity;
        box-shadow: var(--glow-cyan);
        pointer-events: none;
    }
    
    .particle:nth-child(3n) {
        width: 2px;
        height: 2px;
        opacity: 0.2;
        animation-duration: 30s;
    }
    
    .particle:nth-child(5n) {
        width: 4px;
        height: 4px;
        opacity: 0.25;
        animation-duration: 35s;
    }
    
    @keyframes float {
        0% {
            transform: translate(0, 100vh) rotate(0deg);
            opacity: 0;
        }
        10% {
            opacity: 0.3;
        }
        90% {
            opacity: 0.3;
        }
        100% {
            transform: translate(100vw, -100px) rotate(360deg);
            opacity: 0;
        }
    }
    
    /* ============================================
       HEADER & HERO
       ============================================ */
    header {
        padding: 20px;
        text-align: center;
        background: linear-gradient(135deg, rgba(26, 11, 46, 0.9) 0%, rgba(45, 27, 78, 0.8) 100%);
        border-bottom: 2px solid var(--accent);
        position: relative;
        z-index: 10;
        animation: fadeInDown 0.6s ease-out;
        box-shadow: 0 4px 20px rgba(255, 0, 110, 0.2);
        backdrop-filter: blur(10px);
    }
    
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    header h1 {
        margin: 0;
        letter-spacing: 2px;
        font-weight: 900;
        font-size: 2.5rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        filter: drop-shadow(0 0 20px rgba(255, 0, 110, 0.5));
    }
    
    header p {
        margin: 4px 0 0;
        font-size: 0.9rem;
        color: var(--accent-soft);
        opacity: 0.85;
    }
    
    .hero {
        text-align: center;
        padding: 30px 15px 10px;
        animation: fadeIn 0.8s ease-out 0.2s both;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .hero h2 {
        font-weight: 700;
        font-size: 2.2rem;
        background: var(--gradient-text);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
    }
    
    .hero p {
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.6;
        color: var(--muted);
    }
    
    /* ============================================
       WIZARD CONTAINER & STEP INDICATOR
       ============================================ */
    .wizard-container {
        max-width: 900px;
        margin: 20px auto 40px;
        padding: 20px;
        position: relative;
        z-index: 1;
    }
    
    .step-indicator {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .step-dot {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 2px solid var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        color: var(--accent-soft);
        opacity: 0.5;
        transition: all var(--transition-base);
        position: relative;
        background: transparent;
    }
    
    .step-dot::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: var(--accent);
        opacity: 0;
        transform: scale(0);
        transition: all var(--transition-base);
    }
    
    .step-dot.active {
        opacity: 1;
        transform: scale(1.1);
    }
    
    .step-dot.active::before {
        opacity: 1;
        transform: scale(1);
    }
    
    .step-dot.active {
        background: var(--accent);
        color: #0B1C1E;
        box-shadow: 0 0 15px var(--theme-glow);
    }
    
    .step-dot.completed {
        opacity: 0.9;
        background: #163A3D;
        border-color: #163A3D;
    }
    
    .step-dot.completed::after {
        content: '‚úì';
        position: absolute;
        color: var(--accent);
        font-size: 1rem;
    }
    
    /* ============================================
       WIZARD STEPS WITH SMOOTH TRANSITIONS
       ============================================ */
    .wizard-step {
        display: none;
        background: linear-gradient(135deg, rgba(26, 11, 46, 0.6) 0%, rgba(45, 27, 78, 0.4) 100%);
        border-radius: 16px;
        padding: 30px;
        border: 2px solid rgba(255, 0, 110, 0.3);
        position: relative;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity var(--transition-slow), transform var(--transition-slow);
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .wizard-step.active {
        display: block;
        animation: stepFadeIn 0.5s ease-out forwards;
    }
    
    @keyframes stepFadeIn {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .wizard-step h3 {
        margin-top: 0;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        font-size: 1.6rem;
        margin-bottom: 10px;
    }
    
    .wizard-step p {
        color: var(--muted);
        line-height: 1.6;
        margin-bottom: 20px;
    }
    
    /* ============================================
       CHOICE CARDS WITH PREMIUM INTERACTIONS
       ============================================ */
    .choice-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .choice-card {
        background: linear-gradient(135deg, rgba(45, 27, 78, 0.6) 0%, rgba(61, 37, 99, 0.4) 100%);
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        border: 2px solid rgba(255, 0, 110, 0.2);
        text-align: center;
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(5px);
    }
    
    .choice-card::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: var(--theme-glow);
        transform: translate(-50%, -50%);
        transition: width 0.6s ease, height 0.6s ease;
    }
    
    .choice-card:hover {
        border-color: var(--accent);
        transform: translateY(-4px);
        box-shadow: var(--glow-pink), 0 8px 20px rgba(0, 0, 0, 0.3);
    }
    
    .choice-card:hover::before {
        width: 200px;
        height: 200px;
    }
    
    .choice-card.selected {
        border-color: var(--accent);
        box-shadow: var(--glow-pink), 0 8px 25px rgba(0, 0, 0, 0.4);
        transform: translateY(-4px) scale(1.02);
        background: linear-gradient(135deg, rgba(255, 0, 110, 0.2) 0%, rgba(251, 133, 0, 0.1) 100%);
    }
    
    .choice-card.selected::before {
        width: 300px;
        height: 300px;
        background: var(--theme-glow);
    }
    
    .choice-label {
        font-weight: 500;
        margin-bottom: 6px;
        color: var(--accent-soft);
        position: relative;
        z-index: 1;
    }
    
    .choice-desc {
        font-size: 0.85rem;
        color: var(--muted);
        position: relative;
        z-index: 1;
    }
    
    /* ============================================
       AUDIO PLAYER WITH DYNAMIC PREVIEW
       ============================================ */
    .player-demo {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        background: rgba(12, 35, 38, 0.6);
        text-align: center;
        border: 1px dashed #34585c;
        backdrop-filter: blur(10px);
        transition: all var(--transition-base);
    }
    
    .player-
    demo:hover {
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(215, 200, 161, 0.2);
    }
    
    .player-demo strong {
        display: block;
        margin-bottom: 8px;
        color: var(--accent);
    }
    
    .audio-container {
        position: relative;
        margin-top: 12px;
    }
    
    /* Enhanced audio player visibility on dark theme */
    audio {
        width: 100%;
        max-width: 420px;
        height: 40px;
        border-radius: 8px;
        background: rgba(12, 35, 38, 0.6);
        border: 1px solid rgba(215, 200, 161, 0.25);
        padding: 2px 8px;
        box-shadow: 
            inset 0 2px 8px rgba(0, 0, 0, 0.3),
            0 2px 12px rgba(215, 200, 161, 0.1);
    }
    
    audio::-webkit-media-controls-panel {
        background: rgba(215, 200, 161, 0.15);
    }
    
    audio::-webkit-media-controls-current-time-display,
    audio::-webkit-media-controls-time-remaining-display {
        color: var(--accent);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    #morphAudioPlayer {
        margin: 0 auto;
        display: block;
    }
    
    .audio-loading {
        display: none;
        color: var(--muted);
        font-size: 0.85rem;
        margin-top: 8px;
    }
    
    .audio-error {
        display: none;
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 8px;
    }
    
    /* ============================================
       BUTTONS WITH PREMIUM EFFECTS
       ============================================ */
    .wizard-nav {
        display: flex;
        justify-content: space-between;
        margin-top: 25px;
        gap: 12px;
        flex-wrap: wrap;
    }
    
    .btn {
        display: inline-block;
        padding: 14px 32px;
        border-radius: 50px;
        background: var(--gradient-primary);
        color: var(--text);
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-weight: 700;
        font-size: 1rem;
        transition: all var(--transition-base);
        text-align: center;
        position: relative;
        overflow: hidden;
        font-family: inherit;
        box-shadow: var(--glow-pink), 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s ease, height 0.6s ease;
    }
    
    .btn:hover::before {
        width: 300px;
        height: 300px;
    }
    
    .btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 0 30px rgba(255, 0, 110, 0.8), 0 0 60px rgba(255, 107, 53, 0.5), 0 15px 40px rgba(0, 0, 0, 0.4);
    }
    
    .btn:active {
        transform: translateY(0);
        transition: all var(--transition-fast);
    }
    
    .btn.secondary {
        background: var(--gradient-secondary);
        color: var(--text);
        border: none;
        font-weight: 700;
        box-shadow: var(--glow-purple), 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .btn.secondary:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 0 30px rgba(181, 55, 242, 0.8), 0 0 60px rgba(67, 97, 238, 0.5), 0 15px 40px rgba(0, 0, 0, 0.4);
    }
    
    .btn[disabled] {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none !important;
    }
    
    .btn[disabled]:hover {
        box-shadow: none;
    }
    
    /* ============================================
       PACKAGE CARDS WITH ENTRANCE ANIMATIONS
       ============================================ */
    .package-layout {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-top: 25px;
    }
    
    .package-card {
        background: linear-gradient(135deg, rgba(45, 27, 78, 0.6) 0%, rgba(61, 37, 99, 0.4) 100%);
        border-radius: 16px;
        border: 2px solid rgba(255, 0, 110, 0.3);
        padding: 20px;
        position: relative;
        overflow: hidden;
        font-size: 0.95rem;
        transition: all var(--transition-base);
        opacity: 0;
        transform: translateY(20px);
        animation: packageEntrance 0.5s ease-out forwards;
        backdrop-filter: blur(10px);
    }
    
    .package-card:nth-child(1) { animation-delay: 0.1s; }
    .package-card:nth-child(2) { animation-delay: 0.2s; }
    .package-card:nth-child(3) { animation-delay: 0.3s; }
    .package-card:nth-child(4) { animation-delay: 0.4s; }
    .package-card:nth-child(5) { animation-delay: 0.5s; }
    .package-card:nth-child(6) { animation-delay: 0.6s; }
    
    @keyframes packageEntrance {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .package-card:hover {
        transform: translateY(-6px);
        box-shadow: var(--glow-pink), 0 12px 30px rgba(0, 0, 0, 0.4);
        border-color: var(--accent);
    }
    
    .package-card.recommended {
        border-color: var(--accent-orange);
        box-shadow: var(--glow-orange), 0 8px 30px rgba(0, 0, 0, 0.5);
        animation: recommendedPulse 2s ease-in-out infinite;
    }
    
    @keyframes recommendedPulse {
        0%, 100% { box-shadow: var(--glow-orange), 0 8px 30px rgba(0, 0, 0, 0.5); }
        50% { box-shadow: 0 0 40px rgba(251, 133, 0, 0.8), 0 8px 35px rgba(0, 0, 0, 0.6); }
    }
    
    .package-tag {
        position: absolute;
        top: 12px;
        right: -35px;
        background: var(--gradient-primary);
        color: var(--text);
        padding: 6px 45px;
        transform: rotate(25deg);
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: bold;
        box-shadow: var(--glow-pink), 0 4px 10px rgba(0, 0, 0, 0.3);
        animation: tagSlideIn 0.6s ease-out 0.3s both;
    }
    
    @keyframes tagSlideIn {
        from {
            right: -60px;
            opacity: 0;
        }
        to {
            right: -35px;
            opacity: 1;
        }
    }
    
    .package-name {
        font-weight: 500;
        color: var(--accent-soft);
        font-size: 1.1rem;
        margin-bottom: 8px;
    }
    
    .package-price {
        font-size: 1.6rem;
        margin: 8px 0 6px;
        color: var(--accent);
        font-weight: bold;
    }
    
    .package-note {
        font-size: 0.85rem;
        color: var(--muted);
        line-height: 1.5;
        margin-bottom: 12px;
    }
    
    .package-radio {
        margin-top: 12px;
    }
    
    .package-radio label {
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--accent-soft);
        transition: color var(--transition-base);
    }
    
    .package-radio label:hover {
        color: var(--accent);
    }
    
    .package-radio input[type="radio"] {
        cursor: pointer;
        width: 18px;
        height: 18px;
    }
    
    /* ============================================
       ADD-ONS SECTION
       ============================================ */
    .addons {
        margin-top: 30px;
        padding: 20px;
        border-radius: 12px;
        background: #102326;
        border: 1px solid #294749;
        animation: fadeIn 0.6s ease-out 0.4s both;
    }
    
    .addons h4 {
        margin: 0 0 15px;
        color: var(--accent-soft);
        font-size: 1.2rem;
    }
    
    .addon-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px dashed #253c3f;
        font-size: 0.9rem;
        transition: all var(--transition-base);
    }
    
    .addon-item:hover {
        background: rgba(215, 200, 161, 0.05);
        padding-left: 8px;
        border-radius: 6px;
    }
    
    .addon-item:last-child {
        border-bottom: none;
    }
    
    .addon-label {
        max-width: 70%;
        flex: 1;
    }
    
    .addon-item label {
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--accent-soft);
    }
    
    .addon-item input[type="checkbox"] {
        cursor: pointer;
        width: 18px;
        height: 18px;
    }
    
    /* ============================================
       SUBTOTAL WITH ANIMATED COUNTER
       ============================================ */
    .subtotal-box {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        background: #163A3D;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        font-size: 0.95rem;
        border: 2px solid rgba(215, 200, 161, 0.2);
        transition: all var(--transition-base);
    }
    
    .subtotal-box:hover {
        border-color: var(--accent);
        box-shadow: 0 0 20px rgba(215, 200, 161, 0.2);
    }
    
    .subtotal-amount {
        font-size: 2rem;
        font-weight: bold;
        color: var(--accent-soft);
        font-variant-numeric: tabular-nums;
    }
    
    .subtotal-note {
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 4px;
    }
    
    /* ============================================
       FORM STYLING (STEP 5)
       ============================================ */
    .order-form {
        margin-top: 25px;
        animation: fadeIn 0.6s ease-out 0.2s both;
    }
    
    .selection-summary {
        background: rgba(215, 200, 161, 0.1);
        border: 1px solid rgba(215, 200, 161, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        animation: slideInDown 0.5s ease-out;
    }
    
    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .selection-summary h4 {
        color: var(--accent);
        margin-bottom: 12px;
        font-size: 1.1rem;
    }
    
    .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 6px 0;
        border-bottom: 1px dashed rgba(215, 200, 161, 0.2);
        font-size: 0.9rem;
    }
    
    .summary-item:last-child {
        border-bottom: none;
    }
    
    .summary-label {
        color: var(--muted);
    }
    
    .summary-value {
        color: var(--accent-soft);
        font-weight: 500;
    }
    
    .order-form label {
        display: block;
        margin-top: 18px;
        font-size: 0.95rem;
        color: var(--accent-soft);
    }
    
    .order-form input,
    .order-form textarea {
        width: 100%;
        padding: 12px;
        margin-top: 6px;
        border-radius: 8px;
        border: 2px solid #294749;
        font-size: 0.95rem;
        background: var(--bg-softer);
        color: var(--text);
        font-family: inherit;
        transition: all var(--transition-base);
    }
    
    .order-form input:focus,
    .order-form textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(215, 200, 161, 0.2);
    }
    
    .order-form textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    .form-error {
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 4px;
        display: none;
    }
    
    .form-error.show {
        display: block;
        animation: shake 0.4s ease;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    
    .form-success {
        display: none;
        background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(181, 55, 242, 0.1) 100%);
        border: 2px solid var(--accent-cyan);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        color: var(--accent-cyan);
        text-align: center;
        box-shadow: var(--glow-cyan);
        animation: fadeIn 0.5s ease-out;
    }
    
    .form-success.show {
        display: block;
    }
    
    .loading-spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(215, 200, 161, 0.3);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-left: 10px;
        vertical-align: middle;
    }
    
    .loading-spinner.show {
        display: inline-block;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    @keyframes confettiFall {
        0% {
            transform: translateY(0) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(720deg);
            opacity: 0;
        }
    }
    
    @keyframes bokehFloat {
        0%, 100% {
            transform: translate(0, 0) scale(1);
            opacity: 0.3;
        }
        50% {
            transform: translate(30px, -30px) scale(1.2);
            opacity: 0.6;
        }
    }
    
    @keyframes candleFlicker {
        0%, 100% {
            opacity: 0.8;
            transform: translateX(-50%) scaleY(1);
        }
        25% {
            opacity: 1;
            transform: translateX(-50%) scaleY(1.1);
        }
        50% {
            opacity: 0.7;
            transform: translateX(-50%) scaleY(0.9);
        }
        75% {
            opacity: 0.9;
            transform: translateX(-50%) scaleY(1.05);
        }
    }
    
    @keyframes dropIn {
        0% {
            transform: translateY(-50px) scale(0.8);
            opacity: 0;
        }
        60% {
            transform: translateY(5px) scale(1.05);
        }
        100% {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
    }
    
    @keyframes fadeInScale {
        0% {
            transform: scale(0.8);
            opacity: 0;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    @keyframes slideInUp {
        0% {
            transform: translateY(30px);
            opacity: 0;
        }
        100% {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    .note-mini {
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 4px;
        line-height: 1.4;
    }
    
    /* Memory Builder Styles */
    .trait-card, .decade-btn {
        padding: 10px 18px;
        background: rgba(215, 200, 161, 0.1);
        border: 1px solid rgba(215, 200, 161, 0.3);
        border-radius: 20px;
        color: var(--accent);
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
    }
    
    .trait-card:hover, .decade-btn:hover {
        background: rgba(215, 200, 161, 0.2);
        transform: scale(1.05);
        border-color: var(--accent);
    }
    
    .trait-card.selected, .decade-btn.selected {
        background: var(--accent);
        color: #0d0d0d;
        border-color: var(--accent);
        font-weight: bold;
    }
    
    /* ============================================
       LIVE RECOMMENDATION PANEL
       ============================================ */
    .recommendation-panel {
        margin-top: 20px;
        padding: 18px;
        border-radius: 12px;
        background: rgba(215, 200, 161, 0.1);
        border: 1px solid rgba(215, 200, 161, 0.3);
        animation: fadeIn 0.5s ease-out;
    }
    
    .recommendation-panel strong {
        display: block;
        color: var(--accent);
        margin-bottom: 8px;
    }
    
    /* ============================================
       FOOTER
       ============================================ */
    footer {
        text-align: center;
        padding: 30px 20px;
        color: var(--muted);
        font-size: 0.8rem;
        margin-top: 40px;
    }
    
    /* ============================================
       RESPONSIVE DESIGN
       ============================================ */
    @media (max-width: 768px) {
        .wizard-container {
            padding: 15px;
        }
        
        .wizard-step {
            padding: 20px;
        }
        
        .choice-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .package-layout {
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .subtotal-box {
            flex-direction: column;
            text-align: center;
        }
        
        header h1 {
            font-size: 1.5rem;
        }
        
        .hero h2 {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        .wizard-container {
            padding: 10px;
        }
        
        .wizard-step {
            padding: 16px;
        }
        
        .step-dot {
            width: 28px;
            height: 28px;
            font-size: 0.75rem;
        }
        
        /* Enhanced mobile scaling for vibe wheel */
        #vibeWheelContainer {
            transform: scale(0.85);
            margin: 15px 0;
        }
        
        #vibeWheel {
            width: 255px !important;
            height: 255px !important;
        }
        
        /* Audio morph slider mobile optimization */
        #audioMorphContainer {
            padding: 15px;
        }
        
        #styleMorphSlider {
            height: 6px;
        }
    }
    
    @media (max-width: 380px) {
        /* Extra small screens - more aggressive scaling */
        #vibeWheelContainer {
            transform: scale(0.75);
        }
        
        #vibeWheel {
            width: 225px !important;
            height: 225px !important;
        }
        
        #audioMorphContainer {
            padding: 12px;
        }
        
        .choice-card {
            padding: 12px;
        }
        
        .package-card {
            padding: 15px;
        }
    }
    
    /* ============================================
       ACCESSIBILITY
       ============================================ */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }
    
    *:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
    }
    
    /* ============================================
       LANDING PAGE - 90s MIXTAPE AESTHETIC
       ============================================ */
    .landing-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        z-index: 9999;
        background: var(--bg);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1s ease-out, transform 1s ease-out;
    }
    
    .landing-page.fade-out {
        opacity: 0;
        transform: translateY(-50px);
        pointer-events: none;
    }
    
    /* Loading Screen */
    .loading-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.5s ease-out;
    }
    
    .loading-screen.hidden {
        display: none;
    }
    
    .loading-logo {
        width: 200px;
        height: 200px;
        margin-bottom: 30px;
        animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); filter: drop-shadow(0 0 20px rgba(255, 0, 110, 0.6)); }
        50% { transform: scale(1.05); filter: drop-shadow(0 0 40px rgba(251, 133, 0, 0.8)); }
    }
    
    .loading-text {
        font-size: 1.5rem;
        color: var(--text-soft);
        margin-top: 20px;
    }
    
    .loading-spinner {
        position: absolute;
        width: 220px;
        height: 220px;
        border: 4px solid transparent;
        border-top-color: var(--accent);
        border-right-color: var(--accent-orange);
        border-radius: 50%;
        animation: spin 1.5s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Hero Screen */
    .hero-screen {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 20px;
        animation: fadeIn 1s ease-out;
    }
    
    .hero-screen.show {
        display: flex;
    }
    
    .hero-image {
        max-width: 90%;
        width: 600px;
        height: auto;
        margin-bottom: 40px;
        animation: slideInUp 1s ease-out;
        filter: drop-shadow(0 20px 60px rgba(255, 0, 110, 0.4));
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .hero-tagline {
        font-size: 1.8rem;
        background: var(--gradient-text);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
        font-weight: 700;
        animation: fadeIn 1.2s ease-out 0.3s both;
    }
    
    .hero-subtitle {
        font-size: 1.2rem;
        color: var(--text-soft);
        margin-bottom: 40px;
        animation: fadeIn 1.4s ease-out 0.5s both;
        max-width: 600px;
    }
    
    .hero-cta {
        display: inline-block;
        padding: 18px 50px;
        border-radius: 50px;
        background: var(--gradient-primary);
        color: var(--text);
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-weight: 700;
        font-size: 1.2rem;
        box-shadow: var(--glow-pink), 0 15px 40px rgba(0, 0, 0, 0.4);
        animation: fadeIn 1.6s ease-out 0.7s both;
        transition: all var(--transition-base);
        position: relative;
        z-index: 100;
    }
    
    .hero-cta:hover {
        transform: translateY(-5px) scale(1.08);
        box-shadow: 0 0 40px rgba(255, 0, 110, 1), 0 0 80px rgba(255, 107, 53, 0.6), 0 20px 50px rgba(0, 0, 0, 0.5);
    }
    
    .hero-cta:active {
        transform: translateY(-2px) scale(1.05);
    }
    
    /* Cassette Tape Decorations */
    .tape-decoration {
        position: absolute;
        opacity: 0.3;
        pointer-events: none;
        z-index: -1;
    }
    
    .tape-left {
        left: 5%;
        top: 20%;
        width: 200px;
        animation: floatLeft 6s ease-in-out infinite;
    }
    
    .tape-right {
        right: 5%;
        bottom: 20%;
        width: 200px;
        animation: floatRight 7s ease-in-out infinite;
    }
    
    @keyframes floatLeft {
        0%, 100% { transform: translateY(0) rotate(-5deg); }
        50% { transform: translateY(-20px) rotate(-8deg); }
    }
    
    @keyframes floatRight {
        0%, 100% { transform: translateY(0) rotate(5deg); }
        50% { transform: translateY(-15px) rotate(8deg); }
    }
    
    .bars-decoration {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 200px;
        opacity: 0.4;
        object-fit: cover;
        object-position: bottom;
    }
    
    @media (max-width: 768px) {
        .hero-image { width: 90%; }
        .hero-tagline { font-size: 1.4rem; }
        .hero-subtitle { font-size: 1rem; }
        .tape-left, .tape-right { width: 120px; opacity: 0.2; }
        .bars-decoration { height: 120px; }
    }
    
    /* Education/About Screen */
    .education-screen {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        text-align: center;
        padding: 30px 20px;
        animation: fadeIn 1s ease-out;
        max-width: 1000px;
        margin: 0 auto;
        max-height: 100vh;
        overflow-y: auto;
    }
    
    .education-screen.show {
        display: flex;
    }
    
    .education-image {
        max-width: 400px;
        width: 90%;
        height: auto;
        margin-bottom: 25px;
        animation: slideInUp 1s ease-out;
        filter: drop-shadow(0 20px 60px rgba(0, 217, 255, 0.4));
    }
    
    .education-title {
        font-size: 2rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        font-weight: 900;
        animation: fadeIn 1.2s ease-out 0.2s both;
    }
    
    .education-content {
        max-width: 700px;
        margin-bottom: 30px;
    }
    
    .education-paragraph {
        font-size: 1.15rem;
        color: var(--text-soft);
        line-height: 1.8;
        margin-bottom: 25px;
        animation: fadeIn 1.4s ease-out 0.4s both;
    }
    
    .education-features {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin: 40px 0;
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
        animation: fadeIn 1.6s ease-out 0.6s both;
    }
    
    .education-feature {
        background: linear-gradient(135deg, rgba(26, 11, 46, 0.8) 0%, rgba(45, 27, 78, 0.8) 100%);
        border: 2px solid rgba(255, 0, 110, 0.3);
        border-radius: 16px;
        padding: 20px;
        backdrop-filter: blur(20px);
        transition: all var(--transition-base);
    }
    
    .education-feature:hover {
        transform: translateY(-5px);
        border-color: var(--accent-cyan);
        box-shadow: var(--glow-cyan);
    }
    
    .education-feature-icon {
        font-size: 2.5rem;
        margin-bottom: 12px;
        filter: drop-shadow(0 0 10px rgba(255, 0, 110, 0.5));
    }
    
    .education-feature-title {
        font-size: 1rem;
        color: var(--accent-orange);
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .education-feature-desc {
        font-size: 0.85rem;
        color: var(--text-soft);
        line-height: 1.5;
    }
    
    @media (max-width: 768px) {
        .education-title { font-size: 1.8rem; }
        .education-paragraph { font-size: 1rem; }
        .education-features { grid-template-columns: 1fr; gap: 15px; }
        .education-image { max-width: 90%; }
    }
    
    /* ============================================
       FLOATING MINI AUDIO PLAYER
       ============================================ */
    .mini-audio-player {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 320px;
        background: linear-gradient(135deg, rgba(26, 11, 46, 0.95) 0%, rgba(45, 27, 78, 0.95) 100%);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(255, 0, 110, 0.4);
        border-radius: 16px;
        padding: 15px;
        box-shadow: var(--glow-pink), 0 10px 40px rgba(0, 0, 0, 0.5);
        z-index: 10000;
        transform: translateY(150%);
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .mini-audio-player.show {
        transform: translateY(0);
    }
    
    .mini-player-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .mini-player-title {
        font-size: 0.75rem;
        color: var(--accent-cyan);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .mini-player-close {
        background: none;
        border: none;
        color: var(--muted);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 6px;
        transition: all var(--transition-fast);
    }
    
    .mini-player-close:hover {
        color: var(--text);
        background: rgba(255, 255, 255, 0.1);
    }
    
    .mini-player-track-info {
        margin-bottom: 15px;
    }
    
    .mini-player-track-name {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .mini-player-track-artist {
        font-size: 0.85rem;
        color: var(--muted);
    }
    
    .mini-player-controls {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 12px;
    }
    
    .mini-player-btn {
        background: none;
        border: none;
        color: var(--text);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .mini-player-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: scale(1.1);
    }
    
    .mini-player-play-btn {
        background: var(--gradient-primary);
        width: 40px;
        height: 40px;
        font-size: 1.4rem;
        box-shadow: var(--glow-pink);
    }
    
    .mini-player-play-btn:hover {
        transform: scale(1.05);
    }
    
    .mini-player-progress {
        flex: 1;
        height: 6px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .mini-player-progress-bar {
        height: 100%;
        background: var(--gradient-primary);
        width: 0%;
        transition: width 0.1s ease;
        border-radius: 3px;
        position: relative;
    }
    
    .mini-player-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 3px;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 2px;
        box-shadow: 0 0 4px rgba(255, 0, 110, 0.8);
    }
    
    .mini-player-time {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: var(--muted);
        margin-top: 6px;
    }
    
    .mini-player-volume {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    
    .mini-player-volume-icon {
        font-size: 1rem;
        color: var(--accent-orange);
    }
    
    .mini-player-volume-slider {
        flex: 1;
        height: 4px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 2px;
        cursor: pointer;
        position: relative;
    }
    
    .mini-player-volume-bar {
        height: 100%;
        background: var(--gradient-secondary);
        width: 70%;
        transition: width 0.1s ease;
        border-radius: 2px;
    }
    
    .mini-player-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: var(--gradient-primary);
        border: none;
        border-radius: 50%;
        color: var(--text);
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: var(--glow-pink), 0 8px 30px rgba(0, 0, 0, 0.4);
        z-index: 9999;
        transition: all var(--transition-base);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .mini-player-toggle:hover {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 0 30px rgba(255, 0, 110, 0.8), 0 0 60px rgba(255, 107, 53, 0.5);
    }
    
    .mini-player-toggle.hidden {
        display: none;
    }
    
    /* Mini Player Visualizer */
    .mini-player-visualizer {
        height: 30px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        gap: 2px;
        padding: 8px 15px;
        background: rgba(10, 1, 24, 0.5);
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .visualizer-bar {
        width: 3px;
        background: linear-gradient(to top, var(--accent-cyan), var(--accent));
        border-radius: 2px;
        transition: height 0.1s ease;
        min-height: 2px;
    }
    
    @media (max-width: 768px) {
        .mini-audio-player {
            width: calc(100% - 40px);
            right: 20px;
            left: 20px;
        }
    }
</style>
</head>
<body>

<!-- 90s Mixtape Landing Page -->
<div class="landing-page" id="landingPage">
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div style="position: relative;">
            <img src="images/LoadingEV.png" alt="EchoVerse Loading" class="loading-logo">
            <div class="loading-spinner"></div>
        </div>
        <div class="loading-text">Loading your music universe...</div>
    </div>
    
    <!-- Hero Screen -->
    <div class="hero-screen" id="heroScreen">
        <img src="images/EVonBike.png" alt="Welcome to EchoVerse" class="hero-image">
        <h1 class="hero-tagline">üéß Your Story, Their Soundtrack üéµ</h1>
        <p class="hero-subtitle">
            Create a custom mixtape experience - A musical tribute that celebrates life, love, and the moments that matter most.
        </p>
        <button class="hero-cta" id="startButton">üé∏ Start Building Your EchoStory</button>
        
        <!-- Cassette Tape Decorations -->
        <img src="images/EV-2Tapes.png" alt="" class="tape-decoration tape-left">
        <img src="images/EV-2Tapes.png" alt="" class="tape-decoration tape-right">
        <img src="images/EV-DigBars.png" alt="" class="bars-decoration">
    </div>
    
    <!-- Education/About Screen -->
    <div class="education-screen" id="educationScreen">
        <img src="images/EV-Echo-verse.png" alt="Custom Music Player" class="education-image">
        
        <h2 class="education-title">More Than Music. A Memory That Lasts Forever.</h2>
        
        <div class="education-content">
            <p class="education-paragraph">
                Imagine giving someone their own custom music player‚Äîfilled with songs written <strong>just for them</strong>. Not a playlist. Not a mixtape. A complete musical universe where <strong>every lyric tells their story</strong>, every melody captures their spirit, and every track is a memory brought to life.
            </p>
            
            <p class="education-paragraph">
                EchoStory transforms the people you love into art. We craft original music about <em>their</em> life, <em>their</em> moments, and <em>their</em> legacy‚Äîthen deliver it in a beautiful, interactive experience they can treasure forever.
            </p>
        </div>
        
        <div class="education-features">
            <div class="education-feature">
                <div class="education-feature-icon">üéµ</div>
                <div class="education-feature-title">100% Original Music</div>
                <div class="education-feature-desc">Every song is custom-written about them. No covers, no generic lyrics‚Äîjust their story in sound.</div>
            </div>
            
            <div class="education-feature">
                <div class="education-feature-icon">üíù</div>
                <div class="education-feature-title">Perfect for Any Occasion</div>
                <div class="education-feature-desc">Birthdays, weddings, anniversaries, retirements‚Äîcelebrate life's biggest moments with something truly unique.</div>
            </div>
            
            <div class="education-feature">
                <div class="education-feature-icon">üé®</div>
                <div class="education-feature-title">Beautiful & Interactive</div>
                <div class="education-feature-desc">Custom artwork, QR codes, tribute pages, and shareable digital keepsakes they'll visit again and again.</div>
            </div>
        </div>
        
        <p class="education-paragraph" style="font-size: 1.3rem; color: var(--accent-orange); font-weight: 700; margin-top: 30px;">
            Ready to create something unforgettable?
        </p>
        
        <button class="hero-cta" id="continueButton">üéß Let's Build Their EchoStory</button>
    </div>
</div>

<!-- Floating Particles -->
<div class="particle" style="left: 10%; animation-delay: 0s;"></div>
<div class="particle" style="left: 20%; animation-delay: 2s;"></div>
<div class="particle" style="left: 30%; animation-delay: 4s;"></div>
<div class="particle" style="left: 40%; animation-delay: 6s;"></div>
<div class="particle" style="left: 50%; animation-delay: 8s;"></div>
<div class="particle" style="left: 60%; animation-delay: 10s;"></div>
<div class="particle" style="left: 70%; animation-delay: 12s;"></div>
<div class="particle" style="left: 80%; animation-delay: 14s;"></div>
<div class="particle" style="left: 90%; animation-delay: 16s;"></div>

<header>
    <h1>EchoStory‚Ñ¢</h1>
    <p>EchoVerse | AeroVista ‚Äî Your story, turned into song.</p>
</header>

<section class="hero">
    <h2>Build a Custom Musical Tribute</h2>
    <p>
        We'll ask you a few quick questions, let you play with some options,
        then show you a tailored EchoStory‚Ñ¢ package with fun add-ons like guestbooks,
        mini-games, and interactive pages. No pressure ‚Äî just explore.
    </p>
</section>

<div class="wizard-container">

    <!-- Step dots (5 steps now) -->
    <div class="step-indicator" role="tablist" aria-label="Wizard steps">
        <div class="step-dot active" data-step-dot="1" role="tab" aria-selected="true" aria-label="Step 1: Choose Vibe">1</div>
        <div class="step-dot" data-step-dot="2" role="tab" aria-selected="false" aria-label="Step 2: Choose Occasion">2</div>
        <div class="step-dot" data-step-dot="3" role="tab" aria-selected="false" aria-label="Step 3: Choose Scale">3</div>
        <div class="step-dot" data-step-dot="4" role="tab" aria-selected="false" aria-label="Step 4: Choose Package">4</div>
        <div class="step-dot" data-step-dot="5" role="tab" aria-selected="false" aria-label="Step 5: Complete Order">5</div>
    </div>

    <!-- STEP 1: VIBE SELECTION -->
    <div class="wizard-step active" data-step="1" role="tabpanel" aria-labelledby="step-1">
        <h3>Step 1 ¬∑ Choose the Vibe</h3>
        <p>What kind of sound feels right for this person? Tap to explore a few moods.</p>

        <!-- Vibe Sampler Wheel -->
        <div id="vibeWheelContainer" style="margin: 25px 0; text-align: center;">
            <h4 style="color: var(--accent); margin-bottom: 15px;">üéß Spin to Discover Your Vibe</h4>
            <div id="vibeWheel" style="width: 300px; height: 300px; margin: 0 auto; position: relative; cursor: pointer; transition: transform 2s cubic-bezier(0.23, 1, 0.32, 1);">
                <svg width="300" height="300" viewBox="0 0 300 300" style="filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));">
                    <circle cx="150" cy="150" r="140" fill="none" stroke="rgba(215, 200, 161, 0.3)" stroke-width="2"/>
                    <g id="wheelSegments"></g>
                    <circle cx="150" cy="150" r="20" fill="var(--accent)" style="filter: drop-shadow(0 0 10px var(--accent));"/>
                    <line x1="150" y1="10" x2="150" y2="30" stroke="var(--accent)" stroke-width="3" stroke-linecap="round" style="filter: drop-shadow(0 0 5px var(--accent));"/>
                </svg>
            </div>
            <button id="spinWheelBtn" class="btn" style="margin-top: 20px;">üé≤ Spin the Wheel</button>
            <p class="note-mini" id="wheelResult" style="margin-top: 15px; min-height: 20px;"></p>
        </div>
        
        <div class="choice-grid" id="vibeChoices" role="group" aria-label="Vibe selection">
            <div class="choice-card" data-vibe="jazz" role="button" tabindex="0" aria-label="Jazz Swing vibe">
                <div class="choice-label">üé∑ Jazz Swing</div>
                <div class="choice-desc">Frank Sinatra, smoky lounge, smooth swing.</div>
            </div>
            <div class="choice-card" data-vibe="lounge" role="button" tabindex="0" aria-label="Lounge vibe">
                <div class="choice-label">üç∏ Lounge</div>
                <div class="choice-desc">Smooth, sophisticated, late-night elegance.</div>
            </div>
            <div class="choice-card" data-vibe="acoustic" role="button" tabindex="0" aria-label="Acoustic vibe">
                <div class="choice-label">üé∏ Acoustic</div>
                <div class="choice-desc">Warm guitar, storytellers, intimate and close.</div>
            </div>
            <div class="choice-card" data-vibe="modernPop" role="button" tabindex="0" aria-label="Modern Pop vibe">
                <div class="choice-label">üé§ Modern Pop</div>
                <div class="choice-desc">Contemporary, vibrant, radio-ready.</div>
            </div>
            <div class="choice-card" data-vibe="country" role="button" tabindex="0" aria-label="Country vibe">
                <div class="choice-label">ü§† Country</div>
                <div class="choice-desc">Heartfelt storytelling, twang and warmth.</div>
            </div>
            <div class="choice-card" data-vibe="lofi" role="button" tabindex="0" aria-label="Lofi / Chill vibe">
                <div class="choice-label">üéπ Lofi / Chill</div>
                <div class="choice-desc">Soft beats, cozy, reflective, late-night vibes.</div>
            </div>
            <div class="choice-card" data-vibe="gamey" role="button" tabindex="0" aria-label="8-bit / Gamey vibe">
                <div class="choice-label">üéÆ 8-bit / Gamey</div>
                <div class="choice-desc">Playful, nostalgic, chiptune-inspired fun.</div>
            </div>
            <div class="choice-card" data-vibe="cinematic" role="button" tabindex="0" aria-label="Cinematic vibe">
                <div class="choice-label">üé¨ Cinematic</div>
                <div class="choice-desc">Big, emotional, soundtrack-style.</div>
            </div>
            <div class="choice-card" data-vibe="loveBallad" role="button" tabindex="0" aria-label="Love Ballad vibe">
                <div class="choice-label">üíï Love Ballad</div>
                <div class="choice-desc">Romantic, tender, heartwarming melodies.</div>
            </div>
            <div class="choice-card" data-vibe="storytelling" role="button" tabindex="0" aria-label="Storytelling Mode vibe">
                <div class="choice-label">üìñ Storytelling Mode</div>
                <div class="choice-desc">Narrative-driven, lyrical, poetic.</div>
            </div>
        </div>

        <div class="player-demo">
            <strong>üéµ Preview the Vibe</strong>
            <p class="note-mini" id="audioStatus">
                Select a vibe above to hear a preview snippet.
            </p>
            <div class="audio-container">
                <audio id="audioPlayer" controls preload="none" aria-label="Audio preview player">
                    <source id="audioSource" src="" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                <div class="audio-loading" id="audioLoading">Loading preview...</div>
                <div class="audio-error" id="audioError">Preview unavailable. Audio will be available in your final EchoStory‚Ñ¢.</div>
            </div>
        </div>

        <div class="wizard-nav">
            <button class="btn secondary" disabled aria-label="Previous step">Back</button>
            <button class="btn" id="next1" disabled aria-label="Next step: Choose occasion">Next: Occasion</button>
        </div>
    </div>

    <!-- STEP 2: OCCASION SELECTION -->
    <div class="wizard-step" data-step="2" role="tabpanel" aria-labelledby="step-2">
        <h3>Step 2 ¬∑ What's the Occasion?</h3>
        <p>We'll theme the story, artwork, and interactive elements around this moment.</p>

        <div class="choice-grid" id="occasionChoices" role="group" aria-label="Occasion selection">
            <div class="choice-card" data-occasion="birthday" role="button" tabindex="0" aria-label="Birthday occasion">
                <div class="choice-label">üéÇ Birthday</div>
                <div class="choice-desc">Milestone or just another trip around the sun.</div>
            </div>
            <div class="choice-card" data-occasion="anniversary" role="button" tabindex="0" aria-label="Anniversary occasion">
                <div class="choice-label">üíë Anniversary</div>
                <div class="choice-desc">A shared story, celebrated in song.</div>
            </div>
            <div class="choice-card" data-occasion="wedding" role="button" tabindex="0" aria-label="Wedding occasion">
                <div class="choice-label">üíí Wedding</div>
                <div class="choice-desc">First dance, forever song.</div>
            </div>
            <div class="choice-card" data-occasion="memorial" role="button" tabindex="0" aria-label="Memorial occasion">
                <div class="choice-label">üïØÔ∏è Memorial</div>
                <div class="choice-desc">Gentle remembrance and legacy.</div>
            </div>
            <div class="choice-card" data-occasion="retirement" role="button" tabindex="0" aria-label="Retirement occasion">
                <div class="choice-label">üéì Retirement</div>
                <div class="choice-desc">Closing one chapter, opening another.</div>
            </div>
            <div class="choice-card" data-occasion="other" role="button" tabindex="0" aria-label="Other occasion">
                <div class="choice-label">‚ú® Something Else</div>
                <div class="choice-desc">If your moment doesn't fit a box, that's okay.</div>
            </div>
        </div>

        <div class="wizard-nav">
            <button class="btn secondary" data-back aria-label="Previous step">Back</button>
            <button class="btn" id="next2" disabled aria-label="Next step: Choose scale">Next: How Big?</button>
        </div>
    </div>

    <!-- STEP 3: SCALE SELECTION -->
    <div class="wizard-step" data-step="3" role="tabpanel" aria-labelledby="step-3">
        <h3>Step 3 ¬∑ How Big Should This Feel?</h3>
        <p>This helps us recommend the right EchoStory‚Ñ¢ level before we talk about prices.</p>

        <div class="choice-grid" id="scaleChoices" role="group" aria-label="Scale selection">
            <div class="choice-card" data-scale="small" role="button" tabindex="0" aria-label="Sweet & Simple scale">
                <div class="choice-label">Sweet & Simple</div>
                <div class="choice-desc">A single, special moment captured.</div>
            </div>
            <div class="choice-card" data-scale="medium" role="button" tabindex="0" aria-label="Full Celebration scale">
                <div class="choice-label">Full Celebration</div>
                <div class="choice-desc">A few songs, artwork, and interactive page.</div>
            </div>
            <div class="choice-card" data-scale="big" role="button" tabindex="0" aria-label="Big Legacy Moment scale">
                <div class="choice-label">Big Legacy Moment</div>
                <div class="choice-desc">Multi-song experience, guestbook & keepsakes.</div>
            </div>
        </div>

        <div class="recommendation-panel" id="recommendationPanel" style="display: none;">
            <strong>üí° Our Recommendation</strong>
            <p class="note-mini" id="recText">
                Once you pick a scale, we'll suggest a few packages that usually feel "just right."
            </p>
        </div>

        <div class="wizard-nav">
            <button class="btn secondary" data-back aria-label="Previous step">Back</button>
            <button class="btn" id="next3" disabled aria-label="Next step: Choose package">See Packages & Add-Ons</button>
        </div>
    </div>

    <!-- STEP 4: PACKAGE SELECTION -->
    <div class="wizard-step" data-step="4" role="tabpanel" aria-labelledby="step-4">
        <h3>Step 4 ¬∑ Choose Your EchoStory‚Ñ¢ & Extras</h3>
        <p>
            Based on what you picked, we highlighted a few packages that tend to be the best fit.
            You can adjust and add extras like guestbooks, mini-games, and art packs.
        </p>

        <div class="package-layout" id="packageLayout" role="group" aria-label="Package selection">
            <div class="package-card" data-package="mini" data-base="79">
                <div class="package-name">EchoStory‚Ñ¢ Mini</div>
                <div class="package-price">$79</div>
                <div class="package-note">1 micro-song (45-60 sec) ¬∑ simple tribute page ¬∑ QR code ¬∑ basic album cover ¬∑ message section</div>
                <div class="package-radio">
                    <label><input type="radio" name="package" value="mini" aria-label="Select EchoStory Mini package"> Choose Mini</label>
                </div>
            </div>

            <div class="package-card" data-package="classic" data-base="179">
                <div class="package-name">EchoStory‚Ñ¢ Classic</div>
                <div class="package-price">$179</div>
                <div class="package-note">3 full EchoVerse songs ¬∑ signature style ¬∑ lounge version ¬∑ emotional version ¬∑ tribute page ¬∑ custom album cover ¬∑ QR code ¬∑ note-to-recipient page ¬∑ keepsake PDF</div>
                <div class="package-radio">
                    <label><input type="radio" name="package" value="classic" aria-label="Select EchoStory Classic package"> Choose Classic</label>
                </div>
            </div>

            <div class="package-card" data-package="signature" data-base="349">
                <div class="package-name">EchoStory‚Ñ¢ Signature Experience</div>
                <div class="package-price">$349</div>
                <div class="package-note">5 songs total ¬∑ 2 album covers ¬∑ photo-ready QR poster ¬∑ guestbook embed ¬∑ advanced tribute page ¬∑ AR-style effects ¬∑ family-share link ¬∑ "Story Behind The Song" mini-bio</div>
                <div class="package-radio">
                    <label><input type="radio" name="package" value="signature" aria-label="Select EchoStory Signature package"> Choose Signature</label>
                </div>
            </div>

            <div class="package-card" data-package="legacy" data-base="649">
                <div class="package-name">EchoStory‚Ñ¢ Legacy Edition</div>
                <div class="package-price">$649</div>
                <div class="package-note">7 custom songs ¬∑ interview-based lyrics ¬∑ custom art set (5 images) ¬∑ full tribute site ¬∑ handwritten-style PDF ¬∑ QR-coded wall print ¬∑ private family link ¬∑ 4 color variations</div>
                <div class="package-radio">
                    <label><input type="radio" name="package" value="legacy" aria-label="Select EchoStory Legacy package"> Choose Legacy</label>
                </div>
            </div>

            <div class="package-card" data-package="eternal" data-base="9999">
                <div class="package-name">EchoStory‚Ñ¢ Eternal Legacy Suite</div>
                <div class="package-price">$9,999</div>
                <div class="package-note">Unlimited songs (up to 12) ¬∑ narrated documentary ¬∑ multi-genre reinterpretations ¬∑ 10-20 min tribute film ¬∑ 60-page hardcover book ¬∑ up to 20 custom art pieces ¬∑ permanent EchoVerse domain ¬∑ digital archive USB ¬∑ 3 framed QR displays ¬∑ family-sharing launch kit ¬∑ home-delivered premium package</div>
                <div class="package-radio">
                    <label><input type="radio" name="package" value="eternal" aria-label="Select EchoStory Eternal Legacy package"> Choose Eternal Legacy</label>
                </div>
            </div>
        </div>
        
        <!-- Upsell Chips Container -->
        <div id="upsellChipsContainer" style="display: none; margin-top: 25px; padding: 20px; background: rgba(215, 200, 161, 0.05); border-radius: 12px; border: 1px solid rgba(215, 200, 161, 0.2);">
            <h4 style="margin: 0 0 15px; color: var(--accent); font-size: 1.1rem;">Add to Their EchoStory?</h4>
            <div id="upsellChips" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
        </div>
        
        <!-- Bundle Reveal Animation Container -->
        <div id="bundleRevealContainer" style="display: none; margin-top: 25px; padding: 20px; background: rgba(215, 200, 161, 0.1); border-radius: 12px; border: 1px solid rgba(215, 200, 161, 0.3); text-align: center; min-height: 200px; position: relative; overflow: hidden;">
            <div id="bundleRevealContent"></div>
        </div>

        <!-- Add-ons -->
        <div class="addons">
            <h4>Add-Ons (Optional)</h4>
            <div class="addon-item">
                <div class="addon-label">
                    Add 2 Extra Songs  
                    <div class="note-mini">Two additional full production tracks in different vibes.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="extra-songs" data-label="2 Extra Songs" data-price="49" aria-label="Add 2 Extra Songs for $49"> +$49</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    Custom Art Pack  
                    <div class="note-mini">Additional covers / still-life / silhouette art to match.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="art-pack" data-label="Custom Art Pack" data-price="39" aria-label="Add Custom Art Pack for $39"> +$39</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    Video Montage  
                    <div class="note-mini">A beautiful video montage set to your EchoStory music.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="video-montage" data-label="Video Montage" data-price="79" aria-label="Add Video Montage for $79"> +$79</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    Hardcover Keepsake PDF  
                    <div class="note-mini">Print-ready hardcover book layout of their story.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="hardcover-pdf" data-label="Hardcover PDF" data-price="25" aria-label="Add Hardcover Keepsake PDF for $25"> +$25</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    QR-Coded Poster  
                    <div class="note-mini">Photo-ready QR poster design for display.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="qr-poster" data-label="QR Poster" data-price="19" aria-label="Add QR-Coded Poster for $19"> +$19</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    Guestbook Page  
                    <div class="note-mini">Friends & family can leave messages; themed to match.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="guestbook" data-label="Guestbook" data-price="12" aria-label="Add Guestbook Page for $12"> +$12</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    All 5 Album Covers  
                    <div class="note-mini">Complete set of all album cover variations.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="album-covers" data-label="All 5 Covers" data-price="15" aria-label="Add All 5 Album Covers for $15"> +$15</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    Audio-Only Pack  
                    <div class="note-mini">Downloadable audio files in multiple formats.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="audio-pack" data-label="Audio Pack" data-price="12" aria-label="Add Audio-Only Pack for $12"> +$12</label>
                </div>
            </div>
            <div class="addon-item">
                <div class="addon-label">
                    Share Kit  
                    <div class="note-mini">Social-ready graphics & shortlink for sharing.</div>
                </div>
                <div>
                    <label><input type="checkbox" class="addon" data-addon-id="share-kit" data-label="Share Kit" data-price="7" aria-label="Add Share Kit for $7"> +$7</label>
                </div>
            </div>
        </div>

        <!-- Subtotal -->
        <div class="subtotal-box">
            <div>
                <div style="font-size: 0.9rem; color: var(--muted);">Current Estimate</div>
                <div class="subtotal-amount" id="subtotalDisplay">$0</div>
                <div class="subtotal-note">
                    Final pricing will be confirmed before you pay. No commitment yet ‚Äî this just sends us your choices.
                </div>
            </div>
            <div>
                <button class="btn" type="button" id="continueToForm" disabled aria-label="Continue to checkout form">
                    Continue to Checkout
                </button>
            </div>
        </div>

        <div class="wizard-nav">
            <button class="btn secondary" data-back aria-label="Previous step">Back</button>
        </div>
    </div>

    <!-- STEP 5: ORDER FORM (SEPARATE SCREEN) -->
    <div class="wizard-step" data-step="5" role="tabpanel" aria-labelledby="step-5">
        <h3>Step 5 ¬∑ Complete Your Order</h3>
        <p>Review your selections and provide your information to complete your EchoStory‚Ñ¢ request.</p>

        <!-- Selection Summary -->
        <div class="selection-summary" id="selectionSummary">
            <h4>Your EchoStory‚Ñ¢ Summary</h4>
            <div class="summary-item">
                <span class="summary-label">Vibe:</span>
                <span class="summary-value" id="summaryVibe">-</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Occasion:</span>
                <span class="summary-value" id="summaryOccasion">-</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Scale:</span>
                <span class="summary-value" id="summaryScale">-</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Package:</span>
                <span class="summary-value" id="summaryPackage">-</span>
            </div>
            <div class="summary-item" id="summaryAddonsRow" style="display: none;">
                <span class="summary-label">Add-ons:</span>
                <span class="summary-value" id="summaryAddons">-</span>
            </div>
            <div class="summary-item" style="border-top: 2px solid rgba(215, 200, 161, 0.3); margin-top: 8px; padding-top: 12px; font-weight: bold;">
                <span class="summary-label">Total Estimate:</span>
                <span class="summary-value" id="summaryTotal" style="color: var(--accent); font-size: 1.2rem;">$0</span>
            </div>
        </div>

        <!-- Order Form -->
        <!-- TODO: Replace YOUR_FORM_ID with your Formspree endpoint ID
             Get it from: https://formspree.io/forms (create a free account)
             Example: action="https://formspree.io/f/abcd1234" -->
        <form class="order-form" id="orderForm" action="https://formspree.io/f/YOUR_FORM_ID" method="POST" novalidate>
            <label for="client_name">Your Name <span style="color: var(--danger);">*</span></label>
            <input type="text" id="client_name" name="client_name" required aria-required="true" aria-describedby="name-error">
            <div class="form-error" id="name-error" role="alert"></div>

            <label for="client_email">Email <span style="color: var(--danger);">*</span></label>
            <input type="email" id="client_email" name="client_email" required aria-required="true" aria-describedby="email-error">
            <div class="note-mini">We'll reply with next steps & Square invoice</div>
            <div class="form-error" id="email-error" role="alert"></div>

            <label for="recipient_name">Name of the Person You're Honoring <span style="color: var(--danger);">*</span></label>
            <input type="text" id="recipient_name" name="recipient_name" required aria-required="true" aria-describedby="recipient-error">
            <div class="form-error" id="recipient-error" role="alert"></div>

            <!-- Memory Builder Interactive Form -->
            <div id="memoryBuilder" style="margin: 25px 0; padding: 20px; background: rgba(215, 200, 161, 0.05); border-radius: 12px; border: 1px dashed rgba(215, 200, 161, 0.3);">
                <h4 style="color: var(--accent); margin-bottom: 15px;">‚ú® Build Their Story</h4>
                
                <label for="memoryTrait" style="display: block; margin-bottom: 8px; color: var(--accent-soft);">What trait best describes them?</label>
                <div id="traitCards" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                    <button type="button" class="trait-card" data-trait="funny">üòÑ Funny</button>
                    <button type="button" class="trait-card" data-trait="gentle">ü§ó Gentle</button>
                    <button type="button" class="trait-card" data-trait="brave">ü¶Å Brave</button>
                    <button type="button" class="trait-card" data-trait="wise">ü¶â Wise</button>
                    <button type="button" class="trait-card" data-trait="creative">üé® Creative</button>
                    <button type="button" class="trait-card" data-trait="kind">üíù Kind</button>
                </div>
                
                <label for="memoryDecade" style="display: block; margin-bottom: 8px; color: var(--accent-soft);">What era shaped them most?</label>
                <div id="decadeButtons" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                    <button type="button" class="decade-btn" data-decade="1950s">1950s</button>
                    <button type="button" class="decade-btn" data-decade="1960s">1960s</button>
                    <button type="button" class="decade-btn" data-decade="1970s">1970s</button>
                    <button type="button" class="decade-btn" data-decade="1980s">1980s</button>
                    <button type="button" class="decade-btn" data-decade="1990s">1990s</button>
                    <button type="button" class="decade-btn" data-decade="2000s">2000s</button>
                    <button type="button" class="decade-btn" data-decade="2010s">2010s</button>
                    <button type="button" class="decade-btn" data-decade="2020s">2020s</button>
                </div>
                
                <label for="memoryMoment" style="display: block; margin-bottom: 8px; color: var(--accent-soft);">A memory they always laugh about?</label>
                <textarea id="memoryMoment" name="memory_moment" rows="3" placeholder="Share a funny or meaningful moment..." style="width: 100%; padding: 12px; background: rgba(12, 35, 38, 0.6); border: 1px solid rgba(215, 200, 161, 0.3); border-radius: 8px; color: var(--text); font-family: inherit; resize: vertical;"></textarea>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(215, 200, 161, 0.2);">
                    <button type="button" id="hearNameBtn" class="btn secondary" style="margin-bottom: 15px;">üé§ Hear Their Name</button>
                    <div id="lyricTeaser" style="margin-top: 15px; padding: 15px; background: rgba(215, 200, 161, 0.1); border-radius: 8px; border-left: 3px solid var(--accent); display: none;">
                        <p style="margin: 0; color: var(--accent); font-style: italic;" id="lyricTeaserText"></p>
                    </div>
                </div>
            </div>
            
            <label for="notes">Anything else we should know? (tone, deadlines, special requests)</label>
            <textarea id="notes" name="notes" rows="5" aria-describedby="notes-help"></textarea>
            <div class="note-mini" id="notes-help">Optional: Share any additional details that will help us create the perfect EchoStory‚Ñ¢</div>

            <!-- Hidden fields populated by JS -->
            <input type="hidden" name="chosen_vibe" id="chosenVibeField">
            <input type="hidden" name="chosen_occasion" id="chosenOccasionField">
            <input type="hidden" name="chosen_scale" id="chosenScaleField">
            <input type="hidden" name="chosen_package" id="chosenPackageField">
            <input type="hidden" name="chosen_addons" id="chosenAddonsField">
            <input type="hidden" name="estimated_total" id="estimatedTotalField">
            <input type="hidden" name="memory_trait" id="memoryTraitField">
            <input type="hidden" name="memory_decade" id="memoryDecadeField">
            <input type="hidden" name="memory_moment" id="memoryMomentField">

            <div class="form-success" id="formSuccess" role="alert">
                <strong>‚úì Thank you!</strong><br>
                Your EchoStory‚Ñ¢ request has been submitted. We'll be in touch soon with next steps.
                <div id="squarePaymentSection" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(215, 200, 161, 0.3); display: none;">
                    <p style="margin-bottom: 15px; color: var(--accent-soft);">
                        <strong>Ready to pay now?</strong><br>
                        <span style="font-size: 0.9rem; color: var(--muted);">
                            Pay for your base package now, or wait for a custom invoice that includes all add-ons.
                        </span>
                    </p>
                    <a href="#" id="squareCheckoutBtn" class="btn" target="_blank" rel="noopener noreferrer" style="display: inline-block; text-decoration: none;">
                        Pay with Square
                    </a>
                    <p style="margin-top: 12px; font-size: 0.85rem; color: var(--muted);">
                        You'll receive a Square invoice via email for any add-ons you selected.
                    </p>
                </div>
            </div>

            <button type="submit" class="btn" id="submitBtn" aria-label="Submit order">
                Send My EchoStory‚Ñ¢ Request
                <span class="loading-spinner" id="submitSpinner"></span>
            </button>
        </form>

        <div class="wizard-nav">
            <button class="btn secondary" data-back aria-label="Previous step">Back</button>
        </div>
    </div>

</div>

<footer>
    EchoStory‚Ñ¢ ¬∑ EchoVerse | AeroVista ¬∑ Built for moments that deserve more than store-bought.
</footer>

<!-- Floating Mini Audio Player -->
<button class="mini-player-toggle hidden" id="miniPlayerToggle">üéµ</button>

<div class="mini-audio-player" id="miniPlayer">
    <div class="mini-player-header">
        <div class="mini-player-title">üéß EchoVerse Preview</div>
        <button class="mini-player-close" id="miniPlayerClose">‚úï</button>
    </div>
    
    <div class="mini-player-track-info">
        <div class="mini-player-track-name" id="miniTrackName">Loading...</div>
        <div class="mini-player-track-artist" id="miniTrackArtist">EchoVerse Sample</div>
    </div>
    
    <div class="mini-player-visualizer" id="miniVisualizer">
        <!-- Bars generated by JS -->
    </div>
    
    <div class="mini-player-controls">
        <button class="mini-player-btn mini-player-play-btn" id="miniPlayBtn">‚ñ∂Ô∏è</button>
        <div class="mini-player-progress" id="miniProgress">
            <div class="mini-player-progress-bar" id="miniProgressBar"></div>
        </div>
    </div>
    
    <div class="mini-player-time">
        <span id="miniCurrentTime">0:00</span>
        <span id="miniDuration">0:00</span>
    </div>
    
    <div class="mini-player-volume">
        <span class="mini-player-volume-icon">üîä</span>
        <div class="mini-player-volume-slider" id="miniVolumeSlider">
            <div class="mini-player-volume-bar" id="miniVolumeBar"></div>
        </div>
    </div>
    
    <audio id="miniPlayerAudio" preload="metadata"></audio>
</div>

<script>
(function() {
    'use strict';
    
    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
        // =====================================
        // SQUARE PAYMENT INTEGRATION
        // =====================================
        // TODO: Add your Square Link IDs from square.link/dashboard
        // Each package needs a unique checkout link (format: sq0idp-xxxxx)
        // 
        // Setup instructions:
        // 1. Go to https://square.link/dashboard
        // 2. Create a payment link for each package tier
        // 3. Copy the Link ID (starts with sq0idp-)
        // 4. Replace 'YOUR_LINK_ID' below with actual IDs
        //
        // Note: If no Link ID is provided, customers will receive an invoice via email instead
        squareLinks: {
            mini: 'YOUR_LINK_ID',        // $79 package
            classic: 'YOUR_LINK_ID',     // $179 package
            signature: 'YOUR_LINK_ID',   // $349 package
            legacy: 'YOUR_LINK_ID',      // $649 package
            eternal: 'YOUR_LINK_ID'      // $9,999 package
        },
        // =====================================
        // AUDIO PREVIEW FILES
        // =====================================
        // TODO: Upload 10 audio preview files to /audio/ directory
        //
        // File requirements:
        // - Format: MP3 (MP4 audio also supported)
        // - Quality: 320kbps recommended for best quality
        // - Duration: 15-30 seconds (short snippets work best)
        // - Naming: Use exact names below (case-sensitive)
        //
        // Files needed:
        audioPreviews: {
            jazz: 'audio/JAZZ _Pocket of Strange Cozy.mp3',                    // Jazz swing preview
            lounge: 'audio/LOUNGE _Slow Melt City.mp3',                        // Lounge vibe preview
            acoustic: 'audio/ACOUSTIC _Hollowbody Daydream Engine.mp3',        // Acoustic guitar preview
            modernPop: 'audio/POP TRIBUTE_Heartline Respawn.extended.mp3',     // Modern pop preview
            country: 'audio/COUNTRY _Prairie Made of Echoes.mp3',              // Country preview
            lofi: 'audio/LOFI _Sleeptight Circuits.mp3',                       // Lofi/chill preview
            gamey: 'audio/GAMEY _ 8-BIT _Pixelbones & Power-Ups.mp3',          // 8-bit/gamey preview
            cinematic: 'audio/You Moved Through the World Like a Bassline.mp3', // Cinematic preview
            loveBallad: 'audio/Strong Quiet Things.mp3',                       // Love ballad preview
            storytelling: 'audio/STORYTELLING_The Sky Signed Your Name.mp3'    // Storytelling mode preview
        },
        morphStyles: ['jazz', 'acoustic', 'lofi', 'gamey', 'cinematic'],
        themes: {
            birthday: {
                primary: '#FFD27F',
                secondary: '#008080',
                accent: '#FFE5B4',
                glow: 'rgba(255, 210, 127, 0.4)',
                effect: 'confetti',
                gradient: 'radial-gradient(circle at 50% 50%, rgba(255, 210, 127, 0.15) 0%, transparent 50%), linear-gradient(135deg, rgba(255, 210, 127, 0.1) 0%, rgba(128, 128, 128, 0.1) 100%)'
            },
            anniversary: {
                primary: '#D7C8A1',
                secondary: '#8B4513',
                accent: '#F2EDE3',
                glow: 'rgba(215, 200, 161, 0.4)',
                effect: 'bokeh',
                gradient: 'radial-gradient(circle at 30% 30%, rgba(215, 200, 161, 0.2) 0%, transparent 40%), radial-gradient(circle at 70% 70%, rgba(139, 69, 19, 0.15) 0%, transparent 40%)'
            },
            wedding: {
                primary: '#F0E6FF',
                secondary: '#6B46C1',
                accent: '#F5F0FF',
                glow: 'rgba(240, 230, 255, 0.4)',
                effect: 'elegant',
                gradient: 'linear-gradient(135deg, rgba(240, 230, 255, 0.2) 0%, rgba(107, 70, 193, 0.15) 100%)'
            },
            memorial: {
                primary: '#C0C0C0',
                secondary: '#4A5568',
                accent: '#E2E8F0',
                glow: 'rgba(192, 192, 192, 0.3)',
                effect: 'candle',
                gradient: 'radial-gradient(circle at 50% 30%, rgba(192, 192, 192, 0.2) 0%, transparent 60%), radial-gradient(ellipse at 50% 100%, rgba(74, 85, 104, 0.1) 0%, transparent 80%)'
            },
            retirement: {
                primary: '#FFD700',
                secondary: '#2D5016',
                accent: '#FFF8DC',
                glow: 'rgba(255, 215, 0, 0.4)',
                effect: 'celebration',
                gradient: 'radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.15) 0%, transparent 50%)'
            },
            other: {
                primary: '#D7C8A1',
                secondary: '#073F46',
                accent: '#F2EDE3',
                glow: 'rgba(215, 200, 161, 0.3)',
                effect: 'default',
                gradient: 'linear-gradient(135deg, rgba(215, 200, 161, 0.1) 0%, rgba(7, 63, 70, 0.1) 100%)'
            }
        },
        packageInclusions: {
            signature: ['guestbook'],
            legacy: ['guestbook'],
            eternal: ['guestbook']
        },
        upsellChips: [
            { id: 'extra-songs', label: '2 Extra Songs', price: 49 },
            { id: 'art-pack', label: 'Art Pack', price: 39 },
            { id: 'hardcover-pdf', label: 'Hardcover PDF', price: 25 },
            { id: 'qr-poster', label: 'QR Poster', price: 19 }
        ],
        vibeWheelOptions: ['jazz', 'lounge', 'acoustic', 'modernPop', 'country', 'lofi', 'gamey', 'cinematic', 'loveBallad', 'storytelling']
    };
    
    // ============================================
    // STATE MANAGEMENT
    // ============================================
    let currentStep = 1;
    const totalSteps = 5;
    
    let selectedVibe = null;
    let selectedOccasion = null;
    let selectedScale = null;
    let selectedPackage = null;
    let selectedAddons = [];
    
    // DOM Elements
    const vibeChoices = document.getElementById('vibeChoices');
    const occasionChoices = document.getElementById('occasionChoices');
    const scaleChoices = document.getElementById('scaleChoices');
    const packageLayout = document.getElementById('packageLayout');
    const subtotalDisplay = document.getElementById('subtotalDisplay');
    const audioPlayer = document.getElementById('audioPlayer');
    const audioSource = document.getElementById('audioSource');
    const audioStatus = document.getElementById('audioStatus');
    const audioLoading = document.getElementById('audioLoading');
    const audioError = document.getElementById('audioError');
    const recommendationPanel = document.getElementById('recommendationPanel');
    const recText = document.getElementById('recText');
    const continueToForm = document.getElementById('continueToForm');
    const orderForm = document.getElementById('orderForm');
    const selectionSummary = document.getElementById('selectionSummary');
    
    // Hidden form fields
    const hiddenVibe = document.getElementById('chosenVibeField');
    const hiddenOccasion = document.getElementById('chosenOccasionField');
    const hiddenScale = document.getElementById('chosenScaleField');
    const hiddenPackage = document.getElementById('chosenPackageField');
    const hiddenAddons = document.getElementById('chosenAddonsField');
    const hiddenTotal = document.getElementById('estimatedTotalField');
    
    // Summary fields
    const summaryVibe = document.getElementById('summaryVibe');
    const summaryOccasion = document.getElementById('summaryOccasion');
    const summaryScale = document.getElementById('summaryScale');
    const summaryPackage = document.getElementById('summaryPackage');
    const summaryAddons = document.getElementById('summaryAddons');
    const summaryTotal = document.getElementById('summaryTotal');
    const summaryAddonsRow = document.getElementById('summaryAddonsRow');
    
    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function formatVibeName(vibe) {
        const names = {
            jazz: 'Jazz Swing',
            lounge: 'Lounge',
            acoustic: 'Acoustic',
            modernPop: 'Modern Pop',
            country: 'Country',
            lofi: 'Lofi / Chill',
            gamey: '8-bit / Gamey',
            cinematic: 'Cinematic',
            loveBallad: 'Love Ballad',
            storytelling: 'Storytelling Mode'
        };
        return names[vibe] || vibe;
    }
    
    function formatOccasionName(occasion) {
        const names = {
            birthday: 'Birthday',
            anniversary: 'Anniversary',
            wedding: 'Wedding',
            memorial: 'Memorial',
            retirement: 'Retirement',
            other: 'Something Else'
        };
        return names[occasion] || occasion;
    }
    
    function formatScaleName(scale) {
        const names = {
            small: 'Sweet & Simple',
            medium: 'Full Celebration',
            big: 'Big Legacy Moment'
        };
        return names[scale] || scale;
    }
    
    function formatPackageName(pkg) {
        const names = {
            mini: 'EchoStory‚Ñ¢ Mini',
            classic: 'EchoStory‚Ñ¢ Classic',
            signature: 'EchoStory‚Ñ¢ Signature Experience',
            legacy: 'EchoStory‚Ñ¢ Legacy Edition',
            eternal: 'EchoStory‚Ñ¢ Eternal Legacy Suite'
        };
        return names[pkg] || pkg;
    }
    
    function animateNumber(element, start, end, duration = 500) {
        const startTime = performance.now();
        const difference = end - start;
        
        function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            const current = Math.round(start + (difference * easeOutQuart));
            
            element.textContent = '$' + current.toLocaleString();
            
            if (progress < 1) {
                requestAnimationFrame(update);
            } else {
                element.textContent = '$' + end.toLocaleString();
            }
        }
        
        requestAnimationFrame(update);
    }
    
    // ============================================
    // STEP NAVIGATION
    // ============================================
    function showStep(step) {
        // Hide all steps
        document.querySelectorAll('.wizard-step').forEach(s => {
            s.classList.remove('active');
        });
        
        // Show target step
        const targetStep = document.querySelector(`.wizard-step[data-step="${step}"]`);
        if (targetStep) {
            targetStep.classList.add('active');
        }
        
        // Update step indicators
        document.querySelectorAll('.step-dot').forEach(dot => {
            const d = Number(dot.dataset.stepDot);
            dot.classList.remove('active', 'completed');
            dot.setAttribute('aria-selected', 'false');
            
            if (d === step) {
                dot.classList.add('active');
                dot.setAttribute('aria-selected', 'true');
            } else if (d < step) {
                dot.classList.add('completed');
            }
        });
        
        currentStep = step;
        
        // Special handling for step 4: ensure all package cards are visible and animated
        if (step === 4) {
            // Small delay to ensure step is fully visible first
            setTimeout(() => {
                const packageCards = document.querySelectorAll('.package-card');
                packageCards.forEach((card, index) => {
                    // Reset to initial animation state
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    
                    // Trigger entrance animation with staggered timing
                    setTimeout(() => {
                        card.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100); // 100ms delay between each card
                });
            }, 100);
        }
        
        // Special handling for step 5
        if (step === 5) {
            updateSelectionSummary();
        }
        
        // Save to localStorage
        saveToLocalStorage();
    }
    
    // ============================================
    // AUDIO PREVIEW SYSTEM
    // ============================================
    function loadAudioPreview(vibe) {
        const audioPath = CONFIG.audioPreviews[vibe];
        if (!audioPath) {
            showAudioError();
            return;
        }
        
        audioLoading.style.display = 'block';
        audioError.style.display = 'none';
        audioStatus.textContent = 'Loading preview...';
        audioPlayer.pause();
        
        audioSource.src = audioPath;
        audioPlayer.load();
        
        audioPlayer.addEventListener('canplay', function onCanPlay() {
            audioLoading.style.display = 'none';
            audioStatus.textContent = `Now playing: ${formatVibeName(vibe)} preview`;
            audioPlayer.removeEventListener('canplay', onCanPlay);
        }, { once: true });
        
        audioPlayer.addEventListener('error', function onError() {
            audioLoading.style.display = 'none';
            showAudioError();
            audioPlayer.removeEventListener('error', onError);
        }, { once: true });
    }
    
    function showAudioError() {
        audioLoading.style.display = 'none';
        audioError.style.display = 'block';
        audioStatus.textContent = 'Preview unavailable. Audio will be available in your final EchoStory‚Ñ¢.';
    }
    
    // ============================================
    // THEME SYSTEM WITH ENHANCED EFFECTS
    // ============================================
    function applyTheme(occasion) {
        const theme = CONFIG.themes[occasion] || CONFIG.themes.other;
        
        document.documentElement.style.setProperty('--theme-primary', theme.primary);
        document.documentElement.style.setProperty('--theme-secondary', theme.secondary);
        document.documentElement.style.setProperty('--theme-accent', theme.accent);
        document.documentElement.style.setProperty('--theme-glow', theme.glow);
        
        // Apply gradient background effect
        if (theme.gradient) {
            const bodyAfter = document.querySelector('body::after');
            document.body.style.setProperty('--theme-gradient', theme.gradient);
        }
        
        // Add occasion-specific effects
        addOccasionEffect(theme.effect);
    }
    
    function addOccasionEffect(effect) {
        // Remove existing effect elements
        document.querySelectorAll('.occasion-effect').forEach(el => el.remove());
        
        if (effect === 'confetti') {
            createConfettiEffect();
        } else if (effect === 'bokeh') {
            createBokehEffect();
        } else if (effect === 'candle') {
            createCandleEffect();
        }
    }
    
    function createConfettiEffect() {
        for (let i = 0; i < 20; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'occasion-effect';
            confetti.style.cssText = `
                position: fixed;
                width: 8px;
                height: 8px;
                background: var(--theme-primary);
                left: ${Math.random() * 100}%;
                top: -10px;
                border-radius: 2px;
                pointer-events: none;
                z-index: 1000;
                animation: confettiFall ${3 + Math.random() * 2}s linear infinite;
                animation-delay: ${Math.random() * 2}s;
            `;
            document.body.appendChild(confetti);
        }
    }
    
    function createBokehEffect() {
        for (let i = 0; i < 10; i++) {
            const bokeh = document.createElement('div');
            bokeh.className = 'occasion-effect';
            const size = 50 + Math.random() * 100;
            bokeh.style.cssText = `
                position: fixed;
                width: ${size}px;
                height: ${size}px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(215, 200, 161, 0.1) 0%, transparent 70%);
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
                pointer-events: none;
                z-index: -1;
                animation: bokehFloat ${10 + Math.random() * 10}s ease-in-out infinite;
                animation-delay: ${Math.random() * 5}s;
            `;
            document.body.appendChild(bokeh);
        }
    }
    
    function createCandleEffect() {
        const candle = document.createElement('div');
        candle.className = 'occasion-effect';
        candle.style.cssText = `
            position: fixed;
            width: 4px;
            height: 60px;
            background: linear-gradient(to top, rgba(192, 192, 192, 0.3) 0%, transparent 100%);
            left: 50%;
            top: 20%;
            transform: translateX(-50%);
            pointer-events: none;
            z-index: -1;
            animation: candleFlicker 3s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(192, 192, 192, 0.2);
        `;
        document.body.appendChild(candle);
    }
    
    // ============================================
    // VIBE SAMPLER WHEEL
    // ============================================
    function initVibeWheel() {
        const wheel = document.getElementById('vibeWheel');
        const wheelSegments = document.getElementById('wheelSegments');
        const spinBtn = document.getElementById('spinWheelBtn');
        const wheelResult = document.getElementById('wheelResult');
        
        if (!wheel || !wheelSegments || !spinBtn) return;
        
        const options = CONFIG.vibeWheelOptions;
        const segmentAngle = 360 / options.length;
        
        // Create wheel segments
        options.forEach((vibe, index) => {
            const angle = index * segmentAngle;
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const startAngle = (angle - 90) * Math.PI / 180;
            const endAngle = (angle + segmentAngle - 90) * Math.PI / 180;
            const radius = 140;
            const x1 = 150 + radius * Math.cos(startAngle);
            const y1 = 150 + radius * Math.sin(startAngle);
            const x2 = 150 + radius * Math.cos(endAngle);
            const y2 = 150 + radius * Math.sin(endAngle);
            const largeArc = segmentAngle > 180 ? 1 : 0;
            
            path.setAttribute('d', `M 150 150 L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`);
            path.setAttribute('fill', `hsl(${index * 36}, 40%, 50%)`);
            path.setAttribute('opacity', '0.7');
            path.setAttribute('data-vibe', vibe);
            wheelSegments.appendChild(path);
            
            // Add text label
            const textAngle = (angle + segmentAngle / 2 - 90) * Math.PI / 180;
            const textRadius = 100;
            const textX = 150 + textRadius * Math.cos(textAngle);
            const textY = 150 + textRadius * Math.sin(textAngle);
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', textX);
            text.setAttribute('y', textY);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', '#fff');
            text.setAttribute('font-size', '12');
            text.setAttribute('font-weight', 'bold');
            text.textContent = formatVibeName(vibe).split(' ')[0];
            wheelSegments.appendChild(text);
        });
        
        let isSpinning = false;
        spinBtn.addEventListener('click', () => {
            if (isSpinning) return;
            isSpinning = true;
            spinBtn.disabled = true;
            
            const spins = 5 + Math.random() * 3;
            const finalAngle = Math.random() * 360;
            const totalRotation = spins * 360 + finalAngle;
            
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            wheelResult.textContent = 'Spinning...';
            
            setTimeout(() => {
                const normalizedAngle = (360 - (finalAngle % 360)) % 360;
                const selectedIndex = Math.floor(normalizedAngle / segmentAngle);
                const selectedVibe = options[selectedIndex];
                
                wheelResult.innerHTML = `üéµ <strong>${formatVibeName(selectedVibe)}</strong> selected!`;
                
                // Auto-select the vibe card (not the SVG wheel segment)
                const vibeCard = document.querySelector(`.choice-card[data-vibe="${selectedVibe}"]`);
                if (vibeCard) {
                    // Programmatically trigger selection
                    const event = new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    });
                    vibeCard.dispatchEvent(event);
                }
                
                // Play preview
                if (CONFIG.audioPreviews[selectedVibe]) {
                    loadAudioPreview(selectedVibe);
                }
                
                isSpinning = false;
                spinBtn.disabled = false;
            }, 2000);
        });
    }
    
    // ============================================
    // AUDIO MORPHING SLIDER (Premium Web Audio API Crossfade)
    // ============================================
    function initAudioMorphSlider() {
        const slider = document.getElementById('styleMorphSlider');
        const morphPlayer = document.getElementById('morphAudioPlayer');
        
        if (!slider || !morphPlayer) return;
        
        // Web Audio API setup for premium crossfade
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioContext = null;
        let currentSource = null;
        let currentGain = null;
        let currentStyle = null;
        let isTransitioning = false;
        
        // Initialize audio context on first interaction
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new AudioContext();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }
        
        // Create audio source with gain control
        function createAudioSource(url) {
            initAudioContext();
            
            const audio = new Audio(url);
            audio.crossOrigin = 'anonymous';
            audio.loop = true;
            
            const source = audioContext.createMediaElementSource(audio);
            const gainNode = audioContext.createGain();
            
            source.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            gainNode.gain.value = 0;
            
            return { audio, source, gainNode };
        }
        
        // Smooth crossfade with 700ms overlap
        function crossfade(newStyle) {
            if (isTransitioning) return;
            isTransitioning = true;
            
            const newUrl = CONFIG.audioPreviews[newStyle];
            if (!newUrl) {
                isTransitioning = false;
                return;
            }
            
            const nextAudioSetup = createAudioSource(newUrl);
            const { audio: nextAudio, gainNode: nextGain } = nextAudioSetup;
            
            // Start playing new track at volume 0
            nextAudio.play().catch(() => {
                isTransitioning = false;
            });
            
            // Crossfade duration
            const fadeDuration = 0.7; // 700ms
            const now = audioContext.currentTime;
            
            // Fade out current
            if (currentGain) {
                currentGain.gain.setValueAtTime(currentGain.gain.value, now);
                currentGain.gain.exponentialRampToValueAtTime(0.01, now + fadeDuration);
            }
            
            // Fade in next
            nextGain.gain.setValueAtTime(0.01, now);
            nextGain.gain.exponentialRampToValueAtTime(0.8, now + fadeDuration);
            
            // Clean up old source after fade
            setTimeout(() => {
                if (currentSource && currentSource.audio) {
                    currentSource.audio.pause();
                    currentSource.audio.src = '';
                }
                currentSource = nextAudioSetup;
                currentGain = nextGain;
                currentStyle = newStyle;
                isTransitioning = false;
            }, fadeDuration * 1000 + 100);
        }
        
        // Slider input handler
        slider.addEventListener('input', (e) => {
            const index = parseInt(e.target.value);
            const style = CONFIG.morphStyles[index];
            
            if (!style || !CONFIG.audioPreviews[style]) return;
            
            // Update background gradient based on slider
            const percentage = (index / (CONFIG.morphStyles.length - 1)) * 100;
            document.body.style.setProperty('--morph-gradient', `linear-gradient(135deg, rgba(215, 200, 161, ${0.1 + percentage * 0.001}) 0%, rgba(12, 35, 38, ${0.8 - percentage * 0.002}) 100%)`);
            
            // Handle audio crossfade
            if (!currentStyle) {
                // First time - just start playing
                initAudioContext();
                const setup = createAudioSource(CONFIG.audioPreviews[style]);
                setup.audio.play().catch(() => {});
                setup.gainNode.gain.setValueAtTime(0.01, audioContext.currentTime);
                setup.gainNode.gain.exponentialRampToValueAtTime(0.8, audioContext.currentTime + 0.5);
                currentSource = setup;
                currentGain = setup.gainNode;
                currentStyle = style;
            } else if (style !== currentStyle && !isTransitioning) {
                // Crossfade to new style
                crossfade(style);
            }
        });
        
        // Fallback: also update the visible audio player
        slider.addEventListener('change', () => {
            const index = parseInt(slider.value);
            const style = CONFIG.morphStyles[index];
            if (style && CONFIG.audioPreviews[style]) {
                morphPlayer.src = CONFIG.audioPreviews[style];
            }
        });
    }
    
    // ============================================
    // BUNDLE REVEAL ANIMATION
    // ============================================
    function showBundleReveal(packageName) {
        const container = document.getElementById('bundleRevealContainer');
        const content = document.getElementById('bundleRevealContent');
        
        if (!container || !content) return;
        
        const packageInfo = {
            mini: { songs: 1, items: ['Micro-song', 'Tribute page', 'QR code', 'Album cover'] },
            classic: { songs: 3, items: ['3 EchoVerse songs', 'Tribute page', 'Album cover', 'QR code', 'Keepsake PDF'] },
            signature: { songs: 5, items: ['5 songs', '2 album covers', 'QR poster', 'Guestbook', 'Tribute page', 'AR effects'] },
            legacy: { songs: 7, items: ['7 custom songs', '5 art pieces', 'Tribute site', 'PDF book', 'QR wall print'] },
            eternal: { songs: 12, items: ['Unlimited songs', 'Documentary', 'Tribute film', 'Hardcover book', '20 art pieces', 'Premium package'] }
        };
        
        const info = packageInfo[packageName] || packageInfo.classic;
        
        container.style.display = 'block';
        
        // Build HTML structure with enhanced stagger timing and bounce
        let itemsHTML = '';
        info.items.forEach((item, index) => {
            itemsHTML += `
                <div style="padding: 12px 20px; background: rgba(215, 200, 161, 0.1); border: 1px solid rgba(215, 200, 161, 0.3); border-radius: 8px; color: var(--accent); font-size: 0.9rem; animation: dropIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); animation-delay: ${index * 0.1}s; animation-fill-mode: both; opacity: 0; transform: translateY(-30px) scale(0.8);">
                    ${item}
                </div>
            `;
        });
        
        content.innerHTML = `
            <div style="animation: slideInUp 0.5s ease-out;">
                <h4 style="color: var(--accent); margin-bottom: 15px;">‚ú® Your ${formatPackageName(packageName)} ‚ú®</h4>
                <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px;">
                    ${itemsHTML}
                </div>
                <p style="margin-top: 20px; color: var(--muted); font-size: 0.9rem; animation: fadeIn 0.5s ease-out ${info.items.length * 0.1 + 0.3}s both;">
                    ${info.songs} ${info.songs === 1 ? 'song' : 'songs'} ¬∑ ${info.items.length} components
                </p>
            </div>
        `;
    }
    
    // ============================================
    // UPSELL CHIPS
    // ============================================
    function showUpsellChips() {
        const container = document.getElementById('upsellChipsContainer');
        const chipsContainer = document.getElementById('upsellChips');
        
        if (!container || !chipsContainer || !selectedPackage) return;
        
        // Don't show upsells for Eternal package
        if (selectedPackage === 'eternal') {
            container.style.display = 'none';
            return;
        }
        
        container.style.display = 'block';
        chipsContainer.innerHTML = '';
        
        CONFIG.upsellChips.forEach((chip, index) => {
            setTimeout(() => {
                const chipBtn = document.createElement('button');
                chipBtn.className = 'upsell-chip';
                chipBtn.style.cssText = `
                    padding: 10px 18px;
                    background: rgba(215, 200, 161, 0.1);
                    border: 1px solid rgba(215, 200, 161, 0.3);
                    border-radius: 20px;
                    color: var(--accent);
                    font-size: 0.9rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    animation: fadeInScale 0.3s ease-out;
                `;
                chipBtn.textContent = `+ ${chip.label} ($${chip.price})`;
                chipBtn.addEventListener('click', () => {
                    // Find matching addon checkbox by exact ID match
                    const matchingAddon = document.querySelector(`.addon[data-addon-id="${chip.id}"]`);
                    if (matchingAddon && !matchingAddon.checked) {
                        matchingAddon.checked = true;
                        matchingAddon.dispatchEvent(new Event('change'));
                        
                        // Visual feedback
                        chipBtn.style.background = 'var(--accent)';
                        chipBtn.style.color = '#0d0d0d';
                        chipBtn.textContent = '‚úì Added';
                        setTimeout(() => {
                            chipBtn.style.background = 'rgba(215, 200, 161, 0.1)';
                            chipBtn.style.color = 'var(--accent)';
                            chipBtn.textContent = `+ ${chip.label} ($${chip.price})`;
                        }, 1000);
                    }
                });
                chipBtn.addEventListener('mouseenter', () => {
                    chipBtn.style.background = 'rgba(215, 200, 161, 0.2)';
                    chipBtn.style.transform = 'scale(1.05)';
                });
                chipBtn.addEventListener('mouseleave', () => {
                    chipBtn.style.background = 'rgba(215, 200, 161, 0.1)';
                    chipBtn.style.transform = 'scale(1)';
                });
                chipsContainer.appendChild(chipBtn);
            }, index * 100);
        });
    }
    
    // ============================================
    // CHOICE HANDLERS
    // ============================================
    function attachChoiceHandler(container, callback, options = {}) {
        const handleSelection = (card) => {
            container.querySelectorAll('.choice-card').forEach(c => {
                c.classList.remove('selected');
                c.setAttribute('aria-pressed', 'false');
            });
            card.classList.add('selected');
            card.setAttribute('aria-pressed', 'true');
            callback(card);
        };
        
        container.addEventListener('click', e => {
            const card = e.target.closest('.choice-card');
            if (!card) return;
            handleSelection(card);
        });
        
        // Keyboard support
        container.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
                const card = e.target.closest('.choice-card');
                if (card) {
                    e.preventDefault();
                    handleSelection(card);
                }
            }
        });
    }
    
    // Vibe selection
    attachChoiceHandler(vibeChoices, card => {
        selectedVibe = card.dataset.vibe;
        hiddenVibe.value = selectedVibe;
        document.getElementById('next1').disabled = false;
        loadAudioPreview(selectedVibe);
        saveToLocalStorage();
    });
    
    // Occasion selection
    attachChoiceHandler(occasionChoices, card => {
        selectedOccasion = card.dataset.occasion;
        hiddenOccasion.value = selectedOccasion;
        document.getElementById('next2').disabled = false;
        applyTheme(selectedOccasion);
        saveToLocalStorage();
    });
    
    // Scale selection
    attachChoiceHandler(scaleChoices, card => {
        selectedScale = card.dataset.scale;
        hiddenScale.value = selectedScale;
        document.getElementById('next3').disabled = false;
        
        let msg = "";
        let recommended = [];
        if (selectedScale === 'small') {
            msg = "Sweet & Simple often lands nicely with EchoStory‚Ñ¢ Lite or Classic.";
            recommended = ['lite', 'classic'];
        } else if (selectedScale === 'medium') {
            msg = "Full Celebration usually feels right in Classic or Signature.";
            recommended = ['classic', 'signature', 'legacy'];
        } else if (selectedScale === 'big') {
            msg = "Big Legacy Moments shine in Signature, Legacy, or Heirloom tiers.";
            recommended = ['signature', 'legacy', 'heirloom'];
        }
        
        recText.textContent = msg;
        recommendationPanel.style.display = 'block';
        
        // Mark recommended packages
        document.querySelectorAll('.package-card').forEach(card => {
            card.classList.remove('recommended');
            const existingTag = card.querySelector('.package-tag');
            if (existingTag) {
                existingTag.remove();
            }
            
            const slug = card.dataset.package;
            if (recommended.includes(slug)) {
                card.classList.add('recommended');
                const tag = document.createElement('div');
                tag.className = 'package-tag';
                tag.textContent = 'Recommended';
                card.appendChild(tag);
            }
        });
        
        saveToLocalStorage();
    });
    
    // ============================================
    // PACKAGE SELECTION
    // ============================================
    packageLayout.addEventListener('change', e => {
        if (e.target.name === 'package') {
            selectedPackage = e.target.value;
            hiddenPackage.value = selectedPackage;
            updateSubtotal();
            updateAddonAvailability();
            
            // Show bundle reveal animation
            showBundleReveal(selectedPackage);
            
            // Show upsell chips
            setTimeout(() => {
                showUpsellChips();
            }, 500);
            
            saveToLocalStorage();
        }
    });
    
    function updateAddonAvailability() {
        if (!selectedPackage) return;
        
        const inclusions = CONFIG.packageInclusions[selectedPackage] || [];
        
        document.querySelectorAll('.addon').forEach(checkbox => {
            const addonLabel = checkbox.dataset.label.toLowerCase();
            const isIncluded = inclusions.some(inc => addonLabel.includes(inc));
            
            if (isIncluded) {
                checkbox.disabled = true;
                checkbox.checked = false;
                const addonItem = checkbox.closest('.addon-item');
                if (addonItem) {
                    addonItem.style.opacity = '0.5';
                    addonItem.title = 'Already included in selected package';
                }
            } else {
                checkbox.disabled = false;
                const addonItem = checkbox.closest('.addon-item');
                if (addonItem) {
                    addonItem.style.opacity = '1';
                    addonItem.title = '';
                }
            }
        });
        
        // Remove any selected addons that are now included
        selectedAddons = selectedAddons.filter(addon => {
            const addonLabel = addon.label.toLowerCase();
            return !inclusions.some(inc => addonLabel.includes(inc));
        });
        updateSubtotal();
    }
    
    // ============================================
    // ADD-ONS HANDLING
    // ============================================
    document.querySelectorAll('.addon').forEach(cb => {
        cb.addEventListener('change', () => {
            const label = cb.dataset.label;
            const price = Number(cb.dataset.price);
            
            if (cb.checked) {
                selectedAddons.push({label, price});
            } else {
                selectedAddons = selectedAddons.filter(a => a.label !== label);
            }
            
            hiddenAddons.value = selectedAddons.map(a => `${a.label} (+$${a.price})`).join(', ');
            updateSubtotal();
            saveToLocalStorage();
        });
    });
    
    // ============================================
    // SUBTOTAL CALCULATOR WITH ANIMATION
    // ============================================
    let currentDisplayedTotal = 0;
    
    function updateSubtotal() {
        let base = 0;
        if (selectedPackage) {
            const card = document.querySelector(`.package-card[data-package="${selectedPackage}"]`);
            if (card) base = Number(card.dataset.base || 0);
        }
        
        let addonsTotal = selectedAddons.reduce((sum, a) => sum + a.price, 0);
        let total = base + addonsTotal;
        
        // Animate number change
        animateNumber(subtotalDisplay, currentDisplayedTotal, total);
        currentDisplayedTotal = total;
        
        hiddenTotal.value = total;
        
        // Enable/disable continue button
        continueToForm.disabled = !selectedPackage || total === 0;
    }
    
    // ============================================
    // SELECTION SUMMARY (STEP 5)
    // ============================================
    function updateSelectionSummary() {
        summaryVibe.textContent = selectedVibe ? formatVibeName(selectedVibe) : '-';
        summaryOccasion.textContent = selectedOccasion ? formatOccasionName(selectedOccasion) : '-';
        summaryScale.textContent = selectedScale ? formatScaleName(selectedScale) : '-';
        summaryPackage.textContent = selectedPackage ? formatPackageName(selectedPackage) : '-';
        
        if (selectedAddons.length > 0) {
            summaryAddons.textContent = selectedAddons.map(a => `${a.label} (+$${a.price})`).join(', ');
            summaryAddonsRow.style.display = 'flex';
        } else {
            summaryAddonsRow.style.display = 'none';
        }
        
        const total = currentDisplayedTotal || 0;
        summaryTotal.textContent = '$' + total.toLocaleString();
    }
    
    // ============================================
    // FORM VALIDATION
    // ============================================
    function validateForm() {
        let isValid = true;
        
        const name = document.getElementById('client_name');
        const email = document.getElementById('client_email');
        const recipient = document.getElementById('recipient_name');
        
        // Name validation
        const nameError = document.getElementById('name-error');
        if (!name.value.trim()) {
            nameError.textContent = 'Please enter your name';
            nameError.classList.add('show');
            isValid = false;
        } else {
            nameError.classList.remove('show');
        }
        
        // Email validation
        const emailError = document.getElementById('email-error');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email.value.trim()) {
            emailError.textContent = 'Please enter your email';
            emailError.classList.add('show');
            isValid = false;
        } else if (!emailRegex.test(email.value)) {
            emailError.textContent = 'Please enter a valid email address';
            emailError.classList.add('show');
            isValid = false;
        } else {
            emailError.classList.remove('show');
        }
        
        // Recipient validation
        const recipientError = document.getElementById('recipient-error');
        if (!recipient.value.trim()) {
            recipientError.textContent = 'Please enter the name of the person you\'re honoring';
            recipientError.classList.add('show');
            isValid = false;
        } else {
            recipientError.classList.remove('show');
        }
        
        return isValid;
    }
    
    // Real-time validation
    ['client_name', 'client_email', 'recipient_name'].forEach(fieldId => {
        const field = document.getElementById(fieldId);
        field.addEventListener('blur', validateForm);
        field.addEventListener('input', function() {
            const error = document.getElementById(fieldId.replace('_', '-') + '-error');
            if (error) {
                error.classList.remove('show');
            }
        });
    });
    
    // ============================================
    // SQUARE PAYMENT INTEGRATION
    // ============================================
    function generateSquareCheckoutUrl() {
        if (!selectedPackage) return null;
        
        const squareLinkId = CONFIG.squareLinks[selectedPackage];
        if (!squareLinkId || squareLinkId === 'YOUR_LINK_ID') {
            return null;
        }
        
        // Build URL with UTM parameters and order details
        const params = new URLSearchParams({
            utm_source: 'echostory_storefront',
            utm_campaign: 'wizard_order',
            utm_medium: 'website'
        });
        
        // Add order details as notes (Square will receive these)
        if (selectedVibe) params.append('vibe', selectedVibe);
        if (selectedOccasion) params.append('occasion', selectedOccasion);
        if (selectedScale) params.append('scale', selectedScale);
        
        return `https://square.link/u/${squareLinkId}?${params.toString()}`;
    }
    
    function showSquarePaymentOption() {
        const squarePaymentSection = document.getElementById('squarePaymentSection');
        const squareCheckoutBtn = document.getElementById('squareCheckoutBtn');
        
        const checkoutUrl = generateSquareCheckoutUrl();
        
        if (checkoutUrl) {
            squareCheckoutBtn.href = checkoutUrl;
            squarePaymentSection.style.display = 'block';
            
            // Track click
            squareCheckoutBtn.addEventListener('click', function() {
                // Analytics tracking could go here
                console.log('Square checkout initiated', {
                    package: selectedPackage,
                    total: currentDisplayedTotal,
                    addons: selectedAddons.length
                });
            });
        } else {
            // If no Square link configured, show message about invoice
            squarePaymentSection.innerHTML = `
                <p style="color: var(--accent-soft);">
                    <strong>Payment Information</strong><br>
                    <span style="font-size: 0.9rem; color: var(--muted);">
                        You'll receive a Square invoice via email with your complete order details and payment link.
                    </span>
                </p>
            `;
            squarePaymentSection.style.display = 'block';
        }
    }
    
    // ============================================
    // FORM SUBMISSION
    // ============================================
    orderForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
            return;
        }
        
        const submitBtn = document.getElementById('submitBtn');
        const submitSpinner = document.getElementById('submitSpinner');
        const formSuccess = document.getElementById('formSuccess');
        
        submitBtn.disabled = true;
        submitSpinner.classList.add('show');
        
        // Populate hidden fields
        hiddenVibe.value = selectedVibe || '';
        hiddenOccasion.value = selectedOccasion || '';
        hiddenScale.value = selectedScale || '';
        hiddenPackage.value = selectedPackage || '';
        hiddenAddons.value = selectedAddons.map(a => `${a.label} (+$${a.price})`).join(', ');
        hiddenTotal.value = currentDisplayedTotal || 0;
        
        // Populate memory builder fields
        const memoryTraitField = document.getElementById('memoryTraitField');
        const memoryDecadeField = document.getElementById('memoryDecadeField');
        const memoryMomentField = document.getElementById('memoryMomentField');
        const selectedTrait = document.querySelector('.trait-card.selected');
        const selectedDecade = document.querySelector('.decade-btn.selected');
        const memoryMoment = document.getElementById('memoryMoment');
        
        if (memoryTraitField) memoryTraitField.value = selectedTrait ? selectedTrait.dataset.trait : '';
        if (memoryDecadeField) memoryDecadeField.value = selectedDecade ? selectedDecade.dataset.decade : '';
        if (memoryMomentField && memoryMoment) memoryMomentField.value = memoryMoment.value || '';
        
        try {
            const formData = new FormData(orderForm);
            const response = await fetch(orderForm.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (response.ok) {
                formSuccess.classList.add('show');
                orderForm.reset();
                
                // Show Square payment option if available
                showSquarePaymentOption();
                
                // Clear localStorage after successful submission
                setTimeout(() => {
                    clearLocalStorage();
                }, 5000); // Keep data for 5 seconds in case of issues
                
                // Scroll to success message
                formSuccess.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                throw new Error('Form submission failed');
            }
        } catch (error) {
            alert('There was an error submitting your request. Please try again or contact us directly.');
            console.error('Form submission error:', error);
        } finally {
            submitBtn.disabled = false;
            submitSpinner.classList.remove('show');
        }
    });
    
    // ============================================
    // LOCALSTORAGE PERSISTENCE
    // ============================================
    function saveToLocalStorage() {
        const data = {
            selectedVibe,
            selectedOccasion,
            selectedScale,
            selectedPackage,
            selectedAddons,
            currentStep,
            timestamp: Date.now()
        };
        localStorage.setItem('echostory_wizard', JSON.stringify(data));
    }
    
    function loadFromLocalStorage() {
        try {
            const stored = localStorage.getItem('echostory_wizard');
            if (!stored) return;
            
            const data = JSON.parse(stored);
            const maxAge = 24 * 60 * 60 * 1000; // 24 hours
            if (Date.now() - data.timestamp > maxAge) {
                clearLocalStorage();
                return;
            }
            
            // Restore selections
            if (data.selectedVibe) {
                selectedVibe = data.selectedVibe;
                const vibeCard = document.querySelector(`[data-vibe="${data.selectedVibe}"]`);
                if (vibeCard) {
                    vibeCard.classList.add('selected');
                    vibeCard.setAttribute('aria-pressed', 'true');
                    document.getElementById('next1').disabled = false;
                    loadAudioPreview(data.selectedVibe);
                }
            }
            
            if (data.selectedOccasion) {
                selectedOccasion = data.selectedOccasion;
                const occasionCard = document.querySelector(`[data-occasion="${data.selectedOccasion}"]`);
                if (occasionCard) {
                    occasionCard.classList.add('selected');
                    occasionCard.setAttribute('aria-pressed', 'true');
                    document.getElementById('next2').disabled = false;
                    applyTheme(data.selectedOccasion);
                }
            }
            
            if (data.selectedScale) {
                selectedScale = data.selectedScale;
                const scaleCard = document.querySelector(`[data-scale="${data.selectedScale}"]`);
                if (scaleCard) {
                    scaleCard.classList.add('selected');
                    scaleCard.setAttribute('aria-pressed', 'true');
                    document.getElementById('next3').disabled = false;
                }
            }
            
            if (data.selectedPackage) {
                selectedPackage = data.selectedPackage;
                const packageRadio = document.querySelector(`input[name="package"][value="${data.selectedPackage}"]`);
                if (packageRadio) {
                    packageRadio.checked = true;
                    updateSubtotal();
                    updateAddonAvailability();
                }
            }
            
            if (data.selectedAddons && data.selectedAddons.length > 0) {
                selectedAddons = data.selectedAddons;
                data.selectedAddons.forEach(addon => {
                    const checkbox = Array.from(document.querySelectorAll('.addon')).find(
                        cb => cb.dataset.label === addon.label
                    );
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
                updateSubtotal();
            }
            
            // Restore step (optional - might want to start fresh)
            // if (data.currentStep) {
            //     showStep(data.currentStep);
            // }
        } catch (error) {
            console.error('Error loading from localStorage:', error);
            clearLocalStorage();
        }
    }
    
    function clearLocalStorage() {
        localStorage.removeItem('echostory_wizard');
    }
    
    // ============================================
    // STEP NAVIGATION BUTTONS
    // ============================================
    document.getElementById('next1').addEventListener('click', () => showStep(2));
    document.getElementById('next2').addEventListener('click', () => showStep(3));
    document.getElementById('next3').addEventListener('click', () => showStep(4));
    continueToForm.addEventListener('click', () => {
        if (selectedPackage) {
            showStep(5);
        }
    });
    
    document.querySelectorAll('[data-back]').forEach(btn => {
        btn.addEventListener('click', () => {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        });
    });
    
    // ============================================
    // MEMORY BUILDER & INTERACTIVE FEATURES
    // ============================================
    function initMemoryBuilder() {
        // Trait cards with ARIA pressed states
        document.querySelectorAll('.trait-card').forEach(card => {
            card.setAttribute('role', 'button');
            card.setAttribute('aria-pressed', 'false');
            card.addEventListener('click', function() {
                document.querySelectorAll('.trait-card').forEach(c => {
                    c.classList.remove('selected');
                    c.setAttribute('aria-pressed', 'false');
                });
                this.classList.add('selected');
                this.setAttribute('aria-pressed', 'true');
                generateLyricTeaser();
            });
        });
        
        // Decade buttons with ARIA pressed states
        document.querySelectorAll('.decade-btn').forEach(btn => {
            btn.setAttribute('role', 'button');
            btn.setAttribute('aria-pressed', 'false');
            btn.addEventListener('click', function() {
                document.querySelectorAll('.decade-btn').forEach(b => {
                    b.classList.remove('selected');
                    b.setAttribute('aria-pressed', 'false');
                });
                this.classList.add('selected');
                this.setAttribute('aria-pressed', 'true');
                generateLyricTeaser();
            });
        });
        
        // Memory moment textarea
        const memoryMoment = document.getElementById('memoryMoment');
        if (memoryMoment) {
            memoryMoment.addEventListener('input', () => {
                generateLyricTeaser();
            });
        }
    }
    
    // ============================================
    // HEAR THEIR NAME EASTER EGG
    // ============================================
    function initHearName() {
        const hearNameBtn = document.getElementById('hearNameBtn');
        if (!hearNameBtn) return;
        
        hearNameBtn.addEventListener('click', () => {
            const recipientName = document.getElementById('recipient_name').value.trim();
            if (!recipientName) {
                alert('Please enter the name of the person you\'re honoring first.');
                return;
            }
            
            // Use Web Speech API
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance();
                utterance.text = `Ladies and gentlemen, tonight we honor ${recipientName}`;
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                utterance.volume = 0.8;
                
                // Try to use a warm voice
                const voices = speechSynthesis.getVoices();
                const warmVoice = voices.find(v => v.name.includes('Google') && v.lang.includes('en')) || 
                                 voices.find(v => v.lang.includes('en-US')) || 
                                 voices[0];
                if (warmVoice) {
                    utterance.voice = warmVoice;
                }
                
                speechSynthesis.speak(utterance);
                
                // Visual feedback
                hearNameBtn.style.background = 'var(--accent)';
                hearNameBtn.style.color = '#0d0d0d';
                setTimeout(() => {
                    hearNameBtn.style.background = '';
                    hearNameBtn.style.color = '';
                }, 2000);
            } else {
                alert('Your browser doesn\'t support text-to-speech. The name will be beautifully spoken in your final EchoStory‚Ñ¢!');
            }
        });
        
        // Load voices when available
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {
                // Voices loaded
            };
        }
    }
    
    // ============================================
    // LYRIC TEASER GENERATOR
    // ============================================
    function generateLyricTeaser() {
        const recipientName = document.getElementById('recipient_name')?.value.trim() || '';
        const selectedTrait = document.querySelector('.trait-card.selected')?.dataset.trait || '';
        const selectedDecade = document.querySelector('.decade-btn.selected')?.dataset.decade || '';
        const memoryMoment = document.getElementById('memoryMoment')?.value.trim() || '';
        
        if (!recipientName) return;
        
        const lyricTeaser = document.getElementById('lyricTeaser');
        const lyricTeaserText = document.getElementById('lyricTeaserText');
        
        if (!lyricTeaser || !lyricTeaserText) return;
        
        // Generate lyric based on inputs
        let lyric = '';
        const templates = [
            `${recipientName} ${selectedTrait ? `laughed like ${selectedTrait} sunshine` : 'shone bright'} on a ${selectedDecade || 'winter'} day...`,
            `In the ${selectedDecade || 'quiet'} moments, ${recipientName}'s ${selectedTrait || 'gentle'} spirit came alive...`,
            `${recipientName} walked through life with ${selectedTrait || 'grace'} and ${selectedDecade || 'timeless'} wisdom...`,
            `The story of ${recipientName}‚Äî${selectedTrait || 'beautiful'}, ${selectedDecade || 'enduring'}, unforgettable...`
        ];
        
        if (memoryMoment) {
            const momentWords = memoryMoment.split(' ').slice(0, 5).join(' ');
            lyric = `${recipientName}... ${momentWords}... a moment that echoes through time.`;
        } else {
            lyric = templates[Math.floor(Math.random() * templates.length)];
        }
        
        lyricTeaserText.textContent = `"${lyric}"`;
        lyricTeaser.style.display = 'block';
        lyricTeaser.style.animation = 'fadeIn 0.5s ease-out';
    }
    
    // ============================================
    // INITIALIZATION
    // ============================================
    // Initialize interactive features
    initVibeWheel();
    initAudioMorphSlider();
    initMemoryBuilder();
    initHearName();
    
    // Watch recipient name for lyric teaser
    const recipientNameInput = document.getElementById('recipient_name');
    if (recipientNameInput) {
        recipientNameInput.addEventListener('input', () => {
            setTimeout(generateLyricTeaser, 500);
        });
    }
    
    // Load saved state
    loadFromLocalStorage();
    
    // Initialize step 1
    showStep(1);
    
    // Create particles
    for (let i = 0; i < 10; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (20 + Math.random() * 15) + 's';
        document.body.appendChild(particle);
    }
    
    // ============================================
    // LANDING PAGE ANIMATION SEQUENCE
    // ============================================
    function initLandingPage() {
        const landingPage = document.getElementById('landingPage');
        const loadingScreen = document.getElementById('loadingScreen');
        const heroScreen = document.getElementById('heroScreen');
        const educationScreen = document.getElementById('educationScreen');
        const startButton = document.getElementById('startButton');
        const continueButton = document.getElementById('continueButton');
        
        // Show loading screen for 2.5 seconds
        setTimeout(() => {
            loadingScreen.classList.add('hidden');
            heroScreen.classList.add('show');
        }, 2500);
        
        // Start button click - show education screen
        startButton.addEventListener('click', () => {
            heroScreen.classList.remove('show');
            heroScreen.style.display = 'none';
            educationScreen.classList.add('show');
        });
        
        // Continue button click - fade out landing page and reveal wizard
        continueButton.addEventListener('click', () => {
            landingPage.classList.add('fade-out');
            
            // Remove landing page after transition
            setTimeout(() => {
                landingPage.style.display = 'none';
                // Scroll to top to ensure wizard is visible
                window.scrollTo(0, 0);
            }, 1000);
        });
    }
    
    // Initialize landing page on load
    initLandingPage();
    
    // ============================================
    // FLOATING MINI AUDIO PLAYER
    // ============================================
    function initMiniPlayer() {
        const miniPlayer = document.getElementById('miniPlayer');
        const miniPlayerToggle = document.getElementById('miniPlayerToggle');
        const miniPlayerAudio = document.getElementById('miniPlayerAudio');
        const playBtn = document.getElementById('miniPlayBtn');
        const miniProgress = document.getElementById('miniProgress');
        const miniProgressBar = document.getElementById('miniProgressBar');
        const miniCurrentTime = document.getElementById('miniCurrentTime');
        const miniDuration = document.getElementById('miniDuration');
        const miniVolumeSlider = document.getElementById('miniVolumeSlider');
        const miniVolumeBar = document.getElementById('miniVolumeBar');
        const miniPlayerClose = document.getElementById('miniPlayerClose');
        
        // Ensure all elements exist before proceeding
        if (!miniPlayer || !miniPlayerToggle || !miniPlayerAudio || !playBtn || 
            !miniProgress || !miniProgressBar || !miniPlayerClose) {
            console.warn('Mini player elements not found, skipping initialization');
            return;
        }
        
        let isPlaying = false;
        
        // Randomly select a song
        const songs = [
            {
                src: 'audio/The Story You Can Hear.mp3',
                title: 'The Story You Can Hear',
                artist: 'EchoVerse Sample'
            },
            {
                src: 'audio/The Story You Can Hear (1).mp3',
                title: 'The Story You Can Hear (Alt)',
                artist: 'EchoVerse Sample'
            }
        ];
        
        const randomSong = songs[Math.floor(Math.random() * songs.length)];
        miniPlayerAudio.src = randomSong.src;
        
        const trackNameEl = document.getElementById('miniTrackName');
        const trackArtistEl = document.getElementById('miniTrackArtist');
        if (trackNameEl) trackNameEl.textContent = randomSong.title;
        if (trackArtistEl) trackArtistEl.textContent = randomSong.artist;
        
        // Show player after landing sequence completes
        const showMiniPlayerWhenReady = setInterval(() => {
            const landingPage = document.getElementById('landingPage');
            if (!landingPage || landingPage.style.display === 'none' || 
                landingPage.classList.contains('fade-out')) {
                clearInterval(showMiniPlayerWhenReady);
                setTimeout(() => {
                    miniPlayerToggle.classList.remove('hidden');
                }, 2000); // 2 seconds after wizard appears
            }
        }, 500); // Check every 500ms
        
        // Toggle player visibility
        miniPlayerToggle.addEventListener('click', () => {
            miniPlayer.classList.add('show');
            miniPlayerToggle.style.display = 'none';
        });
        
        miniPlayerClose.addEventListener('click', () => {
            miniPlayer.classList.remove('show');
            setTimeout(() => {
                miniPlayerToggle.style.display = 'flex';
            }, 400);
        });
        
        // Play/Pause
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                miniPlayerAudio.pause();
                playBtn.textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
            } else {
                miniPlayerAudio.play().catch(err => {
                    console.log('Autoplay prevented:', err);
                });
                playBtn.textContent = '‚è∏Ô∏è';
                isPlaying = true;
            }
        });
        
        // Update progress
        miniPlayerAudio.addEventListener('timeupdate', () => {
            if (miniPlayerAudio.duration) {
                const progress = (miniPlayerAudio.currentTime / miniPlayerAudio.duration) * 100;
                miniProgressBar.style.width = progress + '%';
                miniCurrentTime.textContent = formatTime(miniPlayerAudio.currentTime);
            }
        });
        
        // Update duration
        miniPlayerAudio.addEventListener('loadedmetadata', () => {
            miniDuration.textContent = formatTime(miniPlayerAudio.duration);
        });
        
        // Seek
        miniProgress.addEventListener('click', (e) => {
            if (miniPlayerAudio.duration) {
                const rect = miniProgress.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const width = rect.width;
                const clickPercent = clickX / width;
                miniPlayerAudio.currentTime = clickPercent * miniPlayerAudio.duration;
            }
        });
        
        // Volume control
        miniVolumeSlider.addEventListener('click', (e) => {
            const rect = miniVolumeSlider.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const width = rect.width;
            const volume = Math.max(0, Math.min(1, clickX / width));
            miniPlayerAudio.volume = volume;
            miniVolumeBar.style.width = (volume * 100) + '%';
        });
        
        // Auto-restart when ended
        miniPlayerAudio.addEventListener('ended', () => {
            miniPlayerAudio.currentTime = 0;
            miniPlayerAudio.play();
        });
        
        // Create audio context for visualizer
        let audioContext = null;
        let analyser = null;
        let dataArray = null;
        let animationId = null;
        
        function initVisualizer() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    const source = audioContext.createMediaElementSource(miniPlayerAudio);
                    source.connect(analyser);
                    analyser.connect(audioContext.destination);
                    analyser.fftSize = 64;
                    dataArray = new Uint8Array(analyser.frequencyBinCount);
                    
                    // Create 16 visualizer bars
                    const visualizer = document.getElementById('miniVisualizer');
                    if (visualizer) {
                        visualizer.innerHTML = ''; // Clear any existing bars
                        for (let i = 0; i < 16; i++) {
                            const bar = document.createElement('div');
                            bar.className = 'visualizer-bar';
                            bar.style.height = '2px';
                            visualizer.appendChild(bar);
                        }
                    }
                } catch (error) {
                    console.warn('Web Audio API not available for visualizer:', error);
                }
            }
        }
        
        function animateVisualizer() {
            if (!analyser || !dataArray) return;
            
            analyser.getByteFrequencyData(dataArray);
            const bars = document.querySelectorAll('.visualizer-bar');
            
            bars.forEach((bar, index) => {
                const value = dataArray[index * 2] || 0;
                const height = Math.max(2, (value / 255) * 30);
                bar.style.height = height + 'px';
            });
            
            animationId = requestAnimationFrame(animateVisualizer);
        }
        
        // Play event - update UI and start visualizer
        miniPlayerAudio.addEventListener('play', () => {
            isPlaying = true;
            playBtn.textContent = '‚è∏Ô∏è';
            if (!audioContext) initVisualizer();
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            if (analyser) {
                animateVisualizer();
            }
        });
        
        // Pause event - update UI and stop visualizer
        miniPlayerAudio.addEventListener('pause', () => {
            isPlaying = false;
            playBtn.textContent = '‚ñ∂Ô∏è';
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        });
        
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
    }
    
    // Initialize mini player
    initMiniPlayer();
    
    // ============================================
    // AUDIO PLAYER COORDINATION
    // ============================================
    function coordinateAudioPlayers() {
        const step1Audio = document.getElementById('audioPlayer');
        const miniPlayerAudio = document.getElementById('miniPlayerAudio');
        
        if (step1Audio && miniPlayerAudio) {
            // When mini player starts, pause Step 1 player
            miniPlayerAudio.addEventListener('play', () => {
                if (!step1Audio.paused) {
                    step1Audio.pause();
                }
            });
            
            // When Step 1 player starts, pause mini player
            step1Audio.addEventListener('play', () => {
                if (!miniPlayerAudio.paused) {
                    miniPlayerAudio.pause();
                    // Update mini player UI
                    const miniPlayBtn = document.getElementById('miniPlayBtn');
                    if (miniPlayBtn) {
                        miniPlayBtn.textContent = '‚ñ∂Ô∏è';
                    }
                }
            });
        }
    }
    
    // Coordinate players after a short delay to ensure both are initialized
    setTimeout(coordinateAudioPlayers, 1000);
})();
</script>

</body>
</html>
